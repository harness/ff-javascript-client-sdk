var Ze=Object.create,Ie=Object.defineProperty,et=Object.getPrototypeOf,tt=Object.prototype.hasOwnProperty,nt=Object.getOwnPropertyNames,rt=Object.getOwnPropertyDescriptor;var Y=Object.assign,ke=o=>Ie(o,"__esModule",{value:!0});var it=(o,l)=>()=>(l||(l={exports:{}},o(l.exports,l)),l.exports),at=(o,l)=>{for(var b in l)Ie(o,b,{get:l[b],enumerable:!0})},ot=(o,l,b)=>{if(l&&typeof l=="object"||typeof l=="function")for(let g of nt(l))!tt.call(o,g)&&g!=="default"&&Ie(o,g,{get:()=>l[g],enumerable:!(b=rt(l,g))||b.enumerable});return o},He=o=>ot(ke(Ie(o!=null?Ze(et(o)):{},"default",o&&o.__esModule&&"default"in o?{get:()=>o.default,enumerable:!0}:{value:o,enumerable:!0})),o);var Ae=(o,l,b)=>new Promise((g,z)=>{var W=j=>{try{A(b.next(j))}catch(N){z(N)}},x=j=>{try{A(b.throw(j))}catch(N){z(N)}},A=j=>j.done?g(j.value):Promise.resolve(j.value).then(W,x);A((b=b.apply(o,l)).next())});var Be=it((Le,Oe)=>{(function(o){"use strict";var l=o.setTimeout,b=o.clearTimeout,g=o.XMLHttpRequest,z=o.XDomainRequest,W=o.ActiveXObject,x=o.EventSource,A=o.document,j=o.Promise,N=o.fetch,ve=o.Response,ie=o.TextDecoder,T=o.TextEncoder,C=o.AbortController;if(typeof window!="undefined"&&typeof A!="undefined"&&!("readyState"in A)&&A.body==null&&(A.readyState="loading",window.addEventListener("load",function(e){A.readyState="complete"},!1)),g==null&&W!=null&&(g=function(){return new W("Microsoft.XMLHTTP")}),Object.create==null&&(Object.create=function(e){function n(){}return n.prototype=e,new n}),Date.now||(Date.now=function(){return new Date().getTime()}),C==null){var k=N;N=function(e,n){var r=n.signal;return k(e,{headers:n.headers,credentials:n.credentials,cache:n.cache}).then(function(t){var d=t.body.getReader();return r._reader=d,r._aborted&&r._reader.cancel(),{status:t.status,statusText:t.statusText,headers:t.headers,body:{getReader:function(){return d}}}})},C=function(){this.signal={_reader:null,_aborted:!1},this.abort=function(){this.signal._reader!=null&&this.signal._reader.cancel(),this.signal._aborted=!0}}}function R(){this.bitsNeeded=0,this.codePoint=0}R.prototype.decode=function(e){function n(p,E,c){if(c===1)return p>=128>>E&&p<<E<=2047;if(c===2)return p>=2048>>E&&p<<E<=55295||p>=57344>>E&&p<<E<=65535;if(c===3)return p>=65536>>E&&p<<E<=1114111;throw new Error}function r(p,E){if(p===6*1)return E>>6>15?3:E>31?2:1;if(p===6*2)return E>15?3:2;if(p===6*3)return 3;throw new Error}for(var t=65533,d="",s=this.bitsNeeded,u=this.codePoint,m=0;m<e.length;m+=1){var v=e[m];s!==0&&(v<128||v>191||!n(u<<6|v&63,s-6,r(s,u)))&&(s=0,u=t,d+=String.fromCharCode(u)),s===0?(v>=0&&v<=127?(s=0,u=v):v>=192&&v<=223?(s=6*1,u=v&31):v>=224&&v<=239?(s=6*2,u=v&15):v>=240&&v<=247?(s=6*3,u=v&7):(s=0,u=t),s!==0&&!n(u,s,r(s,u))&&(s=0,u=t)):(s-=6,u=u<<6|v&63),s===0&&(u<=65535?d+=String.fromCharCode(u):(d+=String.fromCharCode(55296+(u-65535-1>>10)),d+=String.fromCharCode(56320+(u-65535-1&1023))))}return this.bitsNeeded=s,this.codePoint=u,d};var oe=function(){try{return new ie().decode(new T().encode("test"),{stream:!0})==="test"}catch(e){console.debug("TextDecoder does not support streaming option. Using polyfill instead: "+e)}return!1};(ie==null||T==null||!oe())&&(ie=R);var $=function(){};function q(e){this.withCredentials=!1,this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=$,this.onload=$,this.onerror=$,this.onreadystatechange=$,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=$}q.prototype.open=function(e,n){this._abort(!0);var r=this,t=this._xhr,d=1,s=0;this._abort=function(c){r._sendTimeout!==0&&(b(r._sendTimeout),r._sendTimeout=0),(d===1||d===2||d===3)&&(d=4,t.onload=$,t.onerror=$,t.onabort=$,t.onprogress=$,t.onreadystatechange=$,t.abort(),s!==0&&(b(s),s=0),c||(r.readyState=4,r.onabort(null),r.onreadystatechange())),d=0};var u=function(){if(d===1){var c=0,S="",Q=void 0;if("contentType"in t)c=200,S="OK",Q=t.contentType;else try{c=t.status,S=t.statusText,Q=t.getResponseHeader("Content-Type")}catch(ye){c=0,S="",Q=void 0}c!==0&&(d=2,r.readyState=2,r.status=c,r.statusText=S,r._contentType=Q,r.onreadystatechange())}},m=function(){if(u(),d===2||d===3){d=3;var c="";try{c=t.responseText}catch(S){}r.readyState=3,r.responseText=c,r.onprogress()}},v=function(c,S){if((S==null||S.preventDefault==null)&&(S={preventDefault:$}),m(),d===1||d===2||d===3){if(d=4,s!==0&&(b(s),s=0),r.readyState=4,c==="load")r.onload(S);else if(c==="error")r.onerror(S);else if(c==="abort")r.onabort(S);else throw new TypeError;r.onreadystatechange()}},p=function(c){t!=null&&(t.readyState===4?(!("onload"in t)||!("onerror"in t)||!("onabort"in t))&&v(t.responseText===""?"error":"load",c):t.readyState===3?"onprogress"in t||m():t.readyState===2&&u())},E=function(){s=l(function(){E()},500),t.readyState===3&&m()};"onload"in t&&(t.onload=function(c){v("load",c)}),"onerror"in t&&(t.onerror=function(c){v("error",c)}),"onabort"in t&&(t.onabort=function(c){v("abort",c)}),"onprogress"in t&&(t.onprogress=m),"onreadystatechange"in t&&(t.onreadystatechange=function(c){p(c)}),("contentType"in t||!("ontimeout"in g.prototype))&&(n+=(n.indexOf("?")===-1?"?":"&")+"padding=true"),t.open(e,n,!0),"readyState"in t&&(s=l(function(){E()},0))},q.prototype.abort=function(){this._abort(!1)},q.prototype.getResponseHeader=function(e){return this._contentType},q.prototype.setRequestHeader=function(e,n){var r=this._xhr;"setRequestHeader"in r&&r.setRequestHeader(e,n)},q.prototype.getAllResponseHeaders=function(){return this._xhr.getAllResponseHeaders!=null&&this._xhr.getAllResponseHeaders()||""},q.prototype.send=function(){if((!("ontimeout"in g.prototype)||!("sendAsBinary"in g.prototype)&&!("mozAnon"in g.prototype))&&A!=null&&A.readyState!=null&&A.readyState!=="complete"){var e=this;e._sendTimeout=l(function(){e._sendTimeout=0,e.send()},4);return}var n=this._xhr;"withCredentials"in n&&(n.withCredentials=this.withCredentials);try{n.send(void 0)}catch(r){throw r}};function se(e){return e.replace(/[A-Z]/g,function(n){return String.fromCharCode(n.charCodeAt(0)+32)})}function _(e){for(var n=Object.create(null),r=e.split(`\r
`),t=0;t<r.length;t+=1){var d=r[t],s=d.split(": "),u=s.shift(),m=s.join(": ");n[se(u)]=m}this._map=n}_.prototype.get=function(e){return this._map[se(e)]},g!=null&&g.HEADERS_RECEIVED==null&&(g.HEADERS_RECEIVED=2);function he(){}he.prototype.open=function(e,n,r,t,d,s,u){e.open("GET",d);var m=0;e.onprogress=function(){var p=e.responseText,E=p.slice(m);m+=E.length,r(E)},e.onerror=function(p){p.preventDefault(),t(new Error("NetworkError"))},e.onload=function(){t(null)},e.onabort=function(){t(null)},e.onreadystatechange=function(){if(e.readyState===g.HEADERS_RECEIVED){var p=e.status,E=e.statusText,c=e.getResponseHeader("Content-Type"),S=e.getAllResponseHeaders();n(p,E,c,new _(S))}},e.withCredentials=s;for(var v in u)Object.prototype.hasOwnProperty.call(u,v)&&e.setRequestHeader(v,u[v]);return e.send(),e};function pe(e){this._headers=e}pe.prototype.get=function(e){return this._headers.get(e)};function V(){}V.prototype.open=function(e,n,r,t,d,s,u){var m=null,v=new C,p=v.signal,E=new ie;return N(d,{headers:u,credentials:s?"include":"same-origin",signal:p,cache:"no-store"}).then(function(c){return m=c.body.getReader(),n(c.status,c.statusText,c.headers.get("Content-Type"),new pe(c.headers)),new j(function(S,Q){var ye=function(){m.read().then(function(U){if(U.done)S(void 0);else{var H=E.decode(U.value,{stream:!0});r(H),ye()}}).catch(function(U){Q(U)})};ye()})}).catch(function(c){if(c.name!=="AbortError")return c}).then(function(c){t(c)}),{abort:function(){m!=null&&m.cancel(),v.abort()}}};function ne(){this._listeners=Object.create(null)}function ge(e){l(function(){throw e},0)}ne.prototype.dispatchEvent=function(e){e.target=this;var n=this._listeners[e.type];if(n!=null)for(var r=n.length,t=0;t<r;t+=1){var d=n[t];try{typeof d.handleEvent=="function"?d.handleEvent(e):d.call(this,e)}catch(s){ge(s)}}},ne.prototype.addEventListener=function(e,n){e=String(e);var r=this._listeners,t=r[e];t==null&&(t=[],r[e]=t);for(var d=!1,s=0;s<t.length;s+=1)t[s]===n&&(d=!0);d||t.push(n)},ne.prototype.removeEventListener=function(e,n){e=String(e);var r=this._listeners,t=r[e];if(t!=null){for(var d=[],s=0;s<t.length;s+=1)t[s]!==n&&d.push(t[s]);d.length===0?delete r[e]:r[e]=d}};function re(e){this.type=e,this.target=void 0}function be(e,n){re.call(this,e),this.data=n.data,this.lastEventId=n.lastEventId}be.prototype=Object.create(re.prototype);function Ee(e,n){re.call(this,e),this.status=n.status,this.statusText=n.statusText,this.headers=n.headers}Ee.prototype=Object.create(re.prototype);function we(e,n){re.call(this,e),this.error=n.error}we.prototype=Object.create(re.prototype);var fe=-1,a=0,f=1,i=2,h=-1,y=0,w=1,O=2,B=3,Te=/^text\/event\-stream(;.*)?$/i,Xe=1e3,qe=18e6,Fe=function(e,n){var r=e==null?n:parseInt(e,10);return r!==r&&(r=n),xe(r)},xe=function(e){return Math.min(Math.max(e,Xe),qe)},de=function(e,n,r){try{typeof n=="function"&&n.call(e,r)}catch(t){ge(t)}};function J(e,n){ne.call(this),n=n||{},this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this.headers=void 0,this._close=void 0,We(this,e,n)}function Je(){return g!=null&&"withCredentials"in g.prototype||z==null?new g:new z}var ze=N!=null&&ve!=null&&"body"in ve.prototype;function We(e,n,r){n=String(n);var t=Boolean(r.withCredentials),d=r.lastEventIdQueryParameterName||"lastEventId",s=xe(1e3),u=Fe(r.heartbeatTimeout,45e3),m="",v=s,p=!1,E=0,c=r.headers||{},S=r.Transport,Q=ze&&S==null?void 0:new q(S!=null?new S:Je()),ye=S!=null&&typeof S!="string"?new S:Q==null?new V:new he,U=void 0,H=0,X=fe,ce="",Ce="",Z="",Re="",L=y,Me=0,ae=0,Ye=function(D,I,K,G){if(X===a)if(D===200&&K!=null&&Te.test(K)){X=f,p=Date.now(),v=s,e.readyState=f;var P=new Ee("open",{status:D,statusText:I,headers:G});e.dispatchEvent(P),de(e,e.onopen,P)}else{var F="";D!==200?(I&&(I=I.replace(/\s+/g," ")),F="EventSource's response has a status "+D+" "+I+" that is not 200. Aborting the connection."):F="EventSource's response has a Content-Type specifying an unsupported type: "+(K==null?"-":K.replace(/\s+/g," "))+". Aborting the connection.",Ve();var P=new Ee("error",{status:D,statusText:I,headers:G});e.dispatchEvent(P),de(e,e.onerror,P),console.error(F)}},Qe=function(D){if(X===f){for(var I=-1,K=0;K<D.length;K+=1){var G=D.charCodeAt(K);(G===`
`.charCodeAt(0)||G==="\r".charCodeAt(0))&&(I=K)}var P=(I!==-1?Re:"")+D.slice(0,I+1);Re=(I===-1?Re:"")+D.slice(I+1),D!==""&&(p=Date.now(),E+=D.length);for(var F=0;F<P.length;F+=1){var G=P.charCodeAt(F);if(L===h&&G===`
`.charCodeAt(0))L=y;else if(L===h&&(L=y),G==="\r".charCodeAt(0)||G===`
`.charCodeAt(0)){if(L!==y){L===w&&(ae=F+1);var ee=P.slice(Me,ae-1),te=P.slice(ae+(ae<F&&P.charCodeAt(ae)===" ".charCodeAt(0)?1:0),F);ee==="data"?(ce+=`
`,ce+=te):ee==="id"?Ce=te:ee==="event"?Z=te:ee==="retry"?(s=Fe(te,s),v=s):ee==="heartbeatTimeout"&&(u=Fe(te,u),H!==0&&(b(H),H=l(function(){me()},u)))}if(L===y){if(ce!==""){m=Ce,Z===""&&(Z="message");var le=new be(Z,{data:ce.slice(1),lastEventId:Ce});if(e.dispatchEvent(le),Z==="open"?de(e,e.onopen,le):Z==="message"?de(e,e.onmessage,le):Z==="error"&&de(e,e.onerror,le),X===i)return}ce="",Z=""}L=G==="\r".charCodeAt(0)?h:y}else L===y&&(Me=F,L=w),L===w?G===":".charCodeAt(0)&&(ae=F+1,L=O):L===O&&(L=B)}}},je=function(D){if(X===f||X===a)X=fe,H!==0&&(b(H),H=0),H=l(function(){me()},v),v=xe(Math.min(s*16,v*2)),e.readyState=a;else if(X===i&&D!=null){console.error(D);var I=new we("error",{error:D});e.dispatchEvent(I),de(e,e.onerror,I)}},Ve=function(){X=i,U!=null&&(U.abort(),U=void 0),H!==0&&(b(H),H=0),e.readyState=i},me=function(){if(H=0,X!==fe){if(!p&&U!=null)je(new Error("No activity within "+u+" milliseconds. "+(X===a?"No response received.":E+" chars received.")+" Reconnecting.")),U!=null&&(U.abort(),U=void 0);else{var D=Math.max((p||Date.now())+u-Date.now(),1);p=!1,H=l(function(){me()},D)}return}p=!1,E=0,H=l(function(){me()},u),X=a,ce="",Z="",Ce=m,Re="",Me=0,ae=0,L=y;var I=n;if(n.slice(0,5)!=="data:"&&n.slice(0,5)!=="blob:"&&m!==""){var K=n.indexOf("?");I=K===-1?n:n.slice(0,K+1)+n.slice(K+1).replace(/(?:^|&)([^=&]*)(?:=[^&]*)?/g,function(te,le){return le===d?"":te}),I+=(n.indexOf("?")===-1?"?":"&")+d+"="+encodeURIComponent(m)}var G=e.withCredentials,P={};P.Accept="text/event-stream";var F=e.headers;if(F!=null)for(var ee in F)Object.prototype.hasOwnProperty.call(F,ee)&&(P[ee]=F[ee]);try{U=ye.open(Q,Ye,Qe,je,I,G,P)}catch(te){throw Ve(),te}};e.url=n,e.readyState=a,e.withCredentials=t,e.headers=c,e._close=Ve,me()}J.prototype=Object.create(ne.prototype),J.prototype.CONNECTING=a,J.prototype.OPEN=f,J.prototype.CLOSED=i,J.prototype.close=function(){this._close()},J.CONNECTING=a,J.OPEN=f,J.CLOSED=i,J.prototype.withCredentials=void 0;var Pe=x;g!=null&&(x==null||!("withCredentials"in x.prototype))&&(Pe=J),function(e){if(typeof Oe=="object"&&typeof Oe.exports=="object"){var n=e(Le);n!==void 0&&(Oe.exports=n)}else typeof define=="function"&&define.amd?define(["exports"],e):e(o)}(function(e){e.EventSourcePolyfill=J,e.NativeEventSource=x,e.EventSource=Pe})})(typeof globalThis=="undefined"?typeof window!="undefined"?window:typeof self!="undefined"?self:Le:globalThis)});ke(exports);at(exports,{Event:()=>M,initialize:()=>ct});var Ue=He(require("jwt-decode")),Ke=He(require("mitt")),Ge=He(Be());var M;(function(o){o.READY="ready",o.CONNECTED="connected",o.DISCONNECTED="disconnected",o.CHANGED="changed",o.ERROR="error"})(M||(M={}));var De=6e4,$e={debug:!1,baseUrl:"https://config.ff.harness.io/api/1.0",eventUrl:"https://events.ff.harness.io/api/1.0",eventsSyncInterval:De,streamEnabled:!0,allAttributesPrivate:!1,privateAttributeNames:[]},ue=(o,...l)=>console.error(`[FF-SDK] ${o}`,...l);var st="1.6.0",ft=500,Ne=globalThis.fetch,dt=Ge.EventSourcePolyfill,Se=!!globalThis.Proxy,_e=o=>{let{value:l}=o;try{switch(o.kind.toLowerCase()){case"int":case"number":l=Number(l);break;case"boolean":l=l.toString().toLowerCase()==="true";break;case"json":l=JSON.parse(l);break}}catch(b){ue(b)}return l},ct=(o,l,b)=>{let g=!1,z,W,x,A,j,N=!0,ve=()=>{N=!1},ie=()=>{N=!0},T=[],C=(0,Ke.default)(),k=Y(Y({},$e),b);k.eventsSyncInterval<De&&(k.eventsSyncInterval=De);let R=(a,...f)=>{k.debug&&console.debug(`[FF-SDK] ${a}`,...f)},oe=a=>{if(N){let f=Date.now();f-a.lastAccessed>ft&&(a.count++,a.lastAccessed=f)}};globalThis.onbeforeunload=()=>{T.length&&globalThis.localStorage&&(ve(),globalThis.localStorage.HARNESS_FF_METRICS=JSON.stringify(T),ie())};let $=(a,f)=>Ae(void 0,null,function*(){return(yield(yield Ne(`${f.baseUrl}/client/auth`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:a,target:Y(Y({},l),{identifier:String(l.identifier)})})})).json()).authToken}),q=0,se=()=>{if(T.length){R("Sending metrics...",{metrics:T,evaluations:_});let a={metricsData:T.map(f=>({timestamp:Date.now(),count:f.count,metricsType:"FFMETRICS",attributes:[{key:"featureIdentifier",value:f.featureIdentifier},{key:"featureName",value:f.featureIdentifier},{key:"variationIdentifier",value:f.variationIdentifier},{key:"target",value:l.identifier},{key:"SDK_NAME",value:"JavaScript"},{key:"SDK_LANGUAGE",value:"JavaScript"},{key:"SDK_TYPE",value:"client"},{key:"SDK_VERSION",value:st}]}))};Ne(`${k.eventUrl}/metrics/${z}?cluster=${W}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${A}`},body:JSON.stringify(a)}).then(()=>{T=[],q=0}).catch(f=>{q++&&(T=[],q=0),R(f)}).finally(()=>{j=window.setTimeout(se,k.eventsSyncInterval)})}else j=window.setTimeout(se,k.eventsSyncInterval)},_={},he=a=>{R("Sending event for",a.flag),Se?C.emit(M.CHANGED,new Proxy(a,{get(f,i){var h;if(f.hasOwnProperty(i)&&i==="value"){let y=f.flag,w=a.value,O=T.find(B=>B.featureIdentifier===y&&B.featureValue===w);O?(oe(O),O.variationIdentifier=((h=_[y])==null?void 0:h.identifier)||""):T.push({featureIdentifier:y,featureValue:String(w),variationIdentifier:_[y].identifier||"",count:N?1:0,lastAccessed:Date.now()}),R("Metrics event: Flag",i,"has been read with value via stream update",w)}return i==="value"?_e(a):a[i]}})):C.emit(M.CHANGED,{deleted:a.deleted,flag:a.flag,value:_e(a)})},pe=function(){return Se?new Proxy({},{get(a,f){var h,y,w;let i=a[f];if(a.hasOwnProperty(f)){let O=a[f],B=T.find(Te=>Te.featureIdentifier===f&&O===Te.featureValue);B?(B.variationIdentifier=((h=_[f])==null?void 0:h.identifier)||"",oe(B)):T.push({featureIdentifier:f,featureValue:O,variationIdentifier:((y=_[f])==null?void 0:y.identifier)||"",count:N?1:0,lastAccessed:Date.now()}),R("Metrics event: Flag:",f,"has been read with value:",O,"variationIdentifier:",(w=_[f])==null?void 0:w.identifier)}return i}}):{}},V=pe();$(o,k).then(a=>{if(g)return;A=a;let f=(0,Ue.default)(a);if(R("Authenticated",f),globalThis.localStorage&&globalThis.localStorage.HARNESS_FF_METRICS)try{delete globalThis.localStorage.HARNESS_FF_METRICS,R("Picking up metrics from previous session")}catch(i){}j=window.setTimeout(se,k.eventsSyncInterval),z=f.environment,W=f.clusterIdentifier,ne().then(()=>{R("Fetch all flags ok",V)}).then(()=>{g||re()}).then(()=>{g||(R("Event stream ready",{storage:V}),C.emit(M.READY,Y({},V)),Se||Object.keys(V).forEach(i=>{var h;T.push({featureIdentifier:i,featureValue:V[i],variationIdentifier:((h=_[i])==null?void 0:h.identifier)||"",count:N?1:0,lastAccessed:Date.now()})}))}).catch(i=>{C.emit(M.ERROR,i)})}).catch(a=>{ue("Authentication error: ",a),C.emit(M.ERROR,a)});let ne=()=>Ae(void 0,null,function*(){try{(yield(yield Ne(`${k.baseUrl}/client/env/${z}/target/${l.identifier}/evaluations?cluster=${W}`,{headers:{Authorization:`Bearer ${A}`}})).json()).forEach(i=>{let h=_e(i),y=V[i.flag];h!==y&&(R("Flag variation has changed for ",i.identifier),V[i.flag]=h,_[i.flag]=Y(Y({},i),{value:h}),he(i))})}catch(a){return ue("Features fetch operation error: ",a),C.emit(M.ERROR,a),a}}),ge=a=>Ae(void 0,null,function*(){var f;try{let i=yield Ne(`${k.baseUrl}/client/env/${z}/target/${l.identifier}/evaluations/${a}?cluster=${W}`,{headers:{Authorization:`Bearer ${A}`}});if(i.ok){let h=yield i.json(),y=_e(h);if(ve(),V[a]=y,_[a]=Y(Y({},h),{value:y}),ie(),he(h),!Se){let w=h.flag,O=T.find(B=>B.featureIdentifier===w&&B.featureValue===h.value);O?(oe(O),O.variationIdentifier=((f=_[w])==null?void 0:f.identifier)||""):T.push({featureIdentifier:w,featureValue:String(h.value),variationIdentifier:_[w].identifier||"",count:N?1:0,lastAccessed:Date.now()})}}else C.emit(M.ERROR,i)}catch(i){ue("Feature fetch operation error: ",i),C.emit(M.ERROR,i)}}),re=()=>{if(!k.streamEnabled){R("Stream is disabled by configuration. Note: Polling is not yet supported");return}x=new dt(`${k.baseUrl}/stream?cluster=${W}`,{headers:{Authorization:`Bearer ${A}`,"API-Key":o}}),x.onopen=i=>{R("Stream connected",i),C.emit(M.CONNECTED)},x.onclose=i=>{R("Stream disconnected"),C.emit(M.DISCONNECTED)},x.onerror=i=>{ue("Stream has issue",i),C.emit(M.ERROR,i)};let a=i=>{switch(i.event){case"create":setTimeout(()=>ge(i.identifier),1e3);break;case"patch":ge(i.identifier);break;case"delete":delete V[i.identifier],C.emit(M.CHANGED,{flag:i.identifier,value:void 0,deleted:!0}),R("Evaluation deleted",{message:i,storage:V});break}},f=i=>{i.event==="patch"&&ne()};x.addEventListener("*",i=>{let h=JSON.parse(i.data);R("Received event from stream: ",h),h.domain==="flag"?a(h):h.domain==="target-segment"&&f(h)})},be=(a,f)=>C.on(a,f),Ee=(a,f)=>{a?C.off(a,f):fe()},we=(a,f)=>{var h;let i=V[a];if(!Se&&i!==void 0){let y=i,w=a,O=T.find(B=>B.featureIdentifier===w&&B.featureValue===y);O?(oe(O),O.variationIdentifier=((h=_[w])==null?void 0:h.identifier)||""):T.push({featureIdentifier:w,featureValue:y,count:N?1:0,variationIdentifier:_[w].identifier||"",lastAccessed:Date.now()})}return i!==void 0?i:f},fe=()=>{g=!0,R("Closing event stream"),V=pe(),_={},clearTimeout(j),C.all.clear(),typeof(x==null?void 0:x.close)=="function"&&x.close()};return{on:be,off:Ee,variation:we,close:fe}};
/** @license
 * eventsource.js
 * Available under MIT License (MIT)
 * https://github.com/Yaffle/EventSource/
 */
