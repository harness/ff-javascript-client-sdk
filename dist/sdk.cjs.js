var Ze=Object.create,_e=Object.defineProperty,et=Object.getPrototypeOf,tt=Object.prototype.hasOwnProperty,nt=Object.getOwnPropertyNames,rt=Object.getOwnPropertyDescriptor;var J=Object.assign,Ge=a=>_e(a,"__esModule",{value:!0});var it=(a,c)=>()=>(c||(c={exports:{}},a(c.exports,c)),c.exports),at=(a,c)=>{for(var S in c)_e(a,S,{get:c[S],enumerable:!0})},ot=(a,c,S)=>{if(c&&typeof c=="object"||typeof c=="function")for(let p of nt(c))!tt.call(a,p)&&p!=="default"&&_e(a,p,{get:()=>c[p],enumerable:!(S=rt(c,p))||S.enumerable});return a},ke=a=>ot(Ge(_e(a!=null?Ze(et(a)):{},"default",a&&a.__esModule&&"default"in a?{get:()=>a.default,enumerable:!0}:{value:a,enumerable:!0})),a);var Ie=(a,c,S)=>new Promise((p,Y)=>{var W=V=>{try{F(S.next(V))}catch(D){Y(D)}},_=V=>{try{F(S.throw(V))}catch(D){Y(D)}},F=V=>V.done?p(V.value):Promise.resolve(V.value).then(W,_);F((S=S.apply(a,c)).next())});var Be=it((Le,Fe)=>{(function(a){"use strict";var c=a.setTimeout,S=a.clearTimeout,p=a.XMLHttpRequest,Y=a.XDomainRequest,W=a.ActiveXObject,_=a.EventSource,F=a.document,V=a.Promise,D=a.fetch,ae=a.Response,se=a.TextDecoder,Ee=a.TextEncoder,O=a.AbortController;if(typeof window!="undefined"&&typeof F!="undefined"&&!("readyState"in F)&&F.body==null&&(F.readyState="loading",window.addEventListener("load",function(e){F.readyState="complete"},!1)),p==null&&W!=null&&(p=function(){return new W("Microsoft.XMLHTTP")}),Object.create==null&&(Object.create=function(e){function n(){}return n.prototype=e,new n}),Date.now||(Date.now=function(){return new Date().getTime()}),O==null){var g=D;D=function(e,n){var o=n.signal;return g(e,{headers:n.headers,credentials:n.credentials,cache:n.cache}).then(function(t){var f=t.body.getReader();return o._reader=f,o._aborted&&o._reader.cancel(),{status:t.status,statusText:t.statusText,headers:t.headers,body:{getReader:function(){return f}}}})},O=function(){this.signal={_reader:null,_aborted:!1},this.abort=function(){this.signal._reader!=null&&this.signal._reader.cancel(),this.signal._aborted=!0}}}function N(){this.bitsNeeded=0,this.codePoint=0}N.prototype.decode=function(e){function n(h,E,d){if(d===1)return h>=128>>E&&h<<E<=2047;if(d===2)return h>=2048>>E&&h<<E<=55295||h>=57344>>E&&h<<E<=65535;if(d===3)return h>=65536>>E&&h<<E<=1114111;throw new Error}function o(h,E){if(h===6*1)return E>>6>15?3:E>31?2:1;if(h===6*2)return E>15?3:2;if(h===6*3)return 3;throw new Error}for(var t=65533,f="",s=this.bitsNeeded,u=this.codePoint,m=0;m<e.length;m+=1){var v=e[m];s!==0&&(v<128||v>191||!n(u<<6|v&63,s-6,o(s,u)))&&(s=0,u=t,f+=String.fromCharCode(u)),s===0?(v>=0&&v<=127?(s=0,u=v):v>=192&&v<=223?(s=6*1,u=v&31):v>=224&&v<=239?(s=6*2,u=v&15):v>=240&&v<=247?(s=6*3,u=v&7):(s=0,u=t),s!==0&&!n(u,s,o(s,u))&&(s=0,u=t)):(s-=6,u=u<<6|v&63),s===0&&(u<=65535?f+=String.fromCharCode(u):(f+=String.fromCharCode(55296+(u-65535-1>>10)),f+=String.fromCharCode(56320+(u-65535-1&1023))))}return this.bitsNeeded=s,this.codePoint=u,f};var w=function(){try{return new se().decode(new Ee().encode("test"),{stream:!0})==="test"}catch(e){console.debug("TextDecoder does not support streaming option. Using polyfill instead: "+e)}return!1};(se==null||Ee==null||!w())&&(se=N);var x=function(){};function Q(e){this.withCredentials=!1,this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=x,this.onload=x,this.onerror=x,this.onreadystatechange=x,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=x}Q.prototype.open=function(e,n){this._abort(!0);var o=this,t=this._xhr,f=1,s=0;this._abort=function(d){o._sendTimeout!==0&&(S(o._sendTimeout),o._sendTimeout=0),(f===1||f===2||f===3)&&(f=4,t.onload=x,t.onerror=x,t.onabort=x,t.onprogress=x,t.onreadystatechange=x,t.abort(),s!==0&&(S(s),s=0),d||(o.readyState=4,o.onabort(null),o.onreadystatechange())),f=0};var u=function(){if(f===1){var d=0,R="",te=void 0;if("contentType"in t)d=200,R="OK",te=t.contentType;else try{d=t.status,R=t.statusText,te=t.getResponseHeader("Content-Type")}catch(be){d=0,R="",te=void 0}d!==0&&(f=2,o.readyState=2,o.status=d,o.statusText=R,o._contentType=te,o.onreadystatechange())}},m=function(){if(u(),f===2||f===3){f=3;var d="";try{d=t.responseText}catch(R){}o.readyState=3,o.responseText=d,o.onprogress()}},v=function(d,R){if((R==null||R.preventDefault==null)&&(R={preventDefault:x}),m(),f===1||f===2||f===3){if(f=4,s!==0&&(S(s),s=0),o.readyState=4,d==="load")o.onload(R);else if(d==="error")o.onerror(R);else if(d==="abort")o.onabort(R);else throw new TypeError;o.onreadystatechange()}},h=function(d){t!=null&&(t.readyState===4?(!("onload"in t)||!("onerror"in t)||!("onabort"in t))&&v(t.responseText===""?"error":"load",d):t.readyState===3?"onprogress"in t||m():t.readyState===2&&u())},E=function(){s=c(function(){E()},500),t.readyState===3&&m()};"onload"in t&&(t.onload=function(d){v("load",d)}),"onerror"in t&&(t.onerror=function(d){v("error",d)}),"onabort"in t&&(t.onabort=function(d){v("abort",d)}),"onprogress"in t&&(t.onprogress=m),"onreadystatechange"in t&&(t.onreadystatechange=function(d){h(d)}),("contentType"in t||!("ontimeout"in p.prototype))&&(n+=(n.indexOf("?")===-1?"?":"&")+"padding=true"),t.open(e,n,!0),"readyState"in t&&(s=c(function(){E()},0))},Q.prototype.abort=function(){this._abort(!1)},Q.prototype.getResponseHeader=function(e){return this._contentType},Q.prototype.setRequestHeader=function(e,n){var o=this._xhr;"setRequestHeader"in o&&o.setRequestHeader(e,n)},Q.prototype.getAllResponseHeaders=function(){return this._xhr.getAllResponseHeaders!=null&&this._xhr.getAllResponseHeaders()||""},Q.prototype.send=function(){if((!("ontimeout"in p.prototype)||!("sendAsBinary"in p.prototype)&&!("mozAnon"in p.prototype))&&F!=null&&F.readyState!=null&&F.readyState!=="complete"){var e=this;e._sendTimeout=c(function(){e._sendTimeout=0,e.send()},4);return}var n=this._xhr;"withCredentials"in n&&(n.withCredentials=this.withCredentials);try{n.send(void 0)}catch(o){throw o}};function ce(e){return e.replace(/[A-Z]/g,function(n){return String.fromCharCode(n.charCodeAt(0)+32)})}function le(e){for(var n=Object.create(null),o=e.split(`\r
`),t=0;t<o.length;t+=1){var f=o[t],s=f.split(": "),u=s.shift(),m=s.join(": ");n[ce(u)]=m}this._map=n}le.prototype.get=function(e){return this._map[ce(e)]},p!=null&&p.HEADERS_RECEIVED==null&&(p.HEADERS_RECEIVED=2);function H(){}H.prototype.open=function(e,n,o,t,f,s,u){e.open("GET",f);var m=0;e.onprogress=function(){var h=e.responseText,E=h.slice(m);m+=E.length,o(E)},e.onerror=function(h){h.preventDefault(),t(new Error("NetworkError"))},e.onload=function(){t(null)},e.onabort=function(){t(null)},e.onreadystatechange=function(){if(e.readyState===p.HEADERS_RECEIVED){var h=e.status,E=e.statusText,d=e.getResponseHeader("Content-Type"),R=e.getAllResponseHeaders();n(h,E,d,new le(R))}},e.withCredentials=s;for(var v in u)Object.prototype.hasOwnProperty.call(u,v)&&e.setRequestHeader(v,u[v]);return e.send(),e};function ye(e){this._headers=e}ye.prototype.get=function(e){return this._headers.get(e)};function me(){}me.prototype.open=function(e,n,o,t,f,s,u){var m=null,v=new O,h=v.signal,E=new se;return D(f,{headers:u,credentials:s?"include":"same-origin",signal:h,cache:"no-store"}).then(function(d){return m=d.body.getReader(),n(d.status,d.statusText,d.headers.get("Content-Type"),new ye(d.headers)),new V(function(R,te){var be=function(){m.read().then(function(U){if(U.done)R(void 0);else{var M=E.decode(U.value,{stream:!0});o(M),be()}}).catch(function(U){te(U)})};be()})}).catch(function(d){if(d.name!=="AbortError")return d}).then(function(d){t(d)}),{abort:function(){m!=null&&m.cancel(),v.abort()}}};function I(){this._listeners=Object.create(null)}function Re(e){c(function(){throw e},0)}I.prototype.dispatchEvent=function(e){e.target=this;var n=this._listeners[e.type];if(n!=null)for(var o=n.length,t=0;t<o;t+=1){var f=n[t];try{typeof f.handleEvent=="function"?f.handleEvent(e):f.call(this,e)}catch(s){Re(s)}}},I.prototype.addEventListener=function(e,n){e=String(e);var o=this._listeners,t=o[e];t==null&&(t=[],o[e]=t);for(var f=!1,s=0;s<t.length;s+=1)t[s]===n&&(f=!0);f||t.push(n)},I.prototype.removeEventListener=function(e,n){e=String(e);var o=this._listeners,t=o[e];if(t!=null){for(var f=[],s=0;s<t.length;s+=1)t[s]!==n&&f.push(t[s]);f.length===0?delete o[e]:o[e]=f}};function Z(e){this.type=e,this.target=void 0}function ue(e,n){Z.call(this,e),this.data=n.data,this.lastEventId=n.lastEventId}ue.prototype=Object.create(Z.prototype);function Se(e,n){Z.call(this,e),this.status=n.status,this.statusText=n.statusText,this.headers=n.headers}Se.prototype=Object.create(Z.prototype);function Ce(e,n){Z.call(this,e),this.error=n.error}Ce.prototype=Object.create(Z.prototype);var Te=-1,z=0,ee=1,fe=2,r=-1,i=0,l=1,T=2,$=3,j=/^text\/event\-stream(;.*)?$/i,P=1e3,X=18e6,ve=function(e,n){var o=e==null?n:parseInt(e,10);return o!==o&&(o=n),xe(o)},xe=function(e){return Math.min(Math.max(e,P),X)},he=function(e,n,o){try{typeof n=="function"&&n.call(e,o)}catch(t){Re(t)}};function q(e,n){I.call(this),n=n||{},this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this.headers=void 0,this._close=void 0,We(this,e,n)}function Je(){return p!=null&&"withCredentials"in p.prototype||Y==null?new p:new Y}var Ye=D!=null&&ae!=null&&"body"in ae.prototype;function We(e,n,o){n=String(n);var t=Boolean(o.withCredentials),f=o.lastEventIdQueryParameterName||"lastEventId",s=xe(1e3),u=ve(o.heartbeatTimeout,45e3),m="",v=s,h=!1,E=0,d=o.headers||{},R=o.Transport,te=Ye&&R==null?void 0:new Q(R!=null?new R:Je()),be=R!=null&&typeof R!="string"?new R:te==null?new me:new H,U=void 0,M=0,K=Te,pe="",Oe="",ne="",Ae="",k=i,He=0,de=0,ze=function(C,b,G,B){if(K===z)if(C===200&&G!=null&&j.test(G)){K=ee,h=Date.now(),v=s,e.readyState=ee;var L=new Se("open",{status:C,statusText:b,headers:B});e.dispatchEvent(L),he(e,e.onopen,L)}else{var A="";C!==200?(b&&(b=b.replace(/\s+/g," ")),A="EventSource's response has a status "+C+" "+b+" that is not 200. Aborting the connection."):A="EventSource's response has a Content-Type specifying an unsupported type: "+(G==null?"-":G.replace(/\s+/g," "))+". Aborting the connection.",Me();var L=new Se("error",{status:C,statusText:b,headers:B});e.dispatchEvent(L),he(e,e.onerror,L),console.error(A)}},Qe=function(C){if(K===ee){for(var b=-1,G=0;G<C.length;G+=1){var B=C.charCodeAt(G);(B===`
`.charCodeAt(0)||B==="\r".charCodeAt(0))&&(b=G)}var L=(b!==-1?Ae:"")+C.slice(0,b+1);Ae=(b===-1?Ae:"")+C.slice(b+1),C!==""&&(h=Date.now(),E+=C.length);for(var A=0;A<L.length;A+=1){var B=L.charCodeAt(A);if(k===r&&B===`
`.charCodeAt(0))k=i;else if(k===r&&(k=i),B==="\r".charCodeAt(0)||B===`
`.charCodeAt(0)){if(k!==i){k===l&&(de=A+1);var re=L.slice(He,de-1),ie=L.slice(de+(de<A&&L.charCodeAt(de)===" ".charCodeAt(0)?1:0),A);re==="data"?(pe+=`
`,pe+=ie):re==="id"?Oe=ie:re==="event"?ne=ie:re==="retry"?(s=ve(ie,s),v=s):re==="heartbeatTimeout"&&(u=ve(ie,u),M!==0&&(S(M),M=c(function(){we()},u)))}if(k===i){if(pe!==""){m=Oe,ne===""&&(ne="message");var ge=new ue(ne,{data:pe.slice(1),lastEventId:Oe});if(e.dispatchEvent(ge),ne==="open"?he(e,e.onopen,ge):ne==="message"?he(e,e.onmessage,ge):ne==="error"&&he(e,e.onerror,ge),K===fe)return}pe="",ne=""}k=B==="\r".charCodeAt(0)?r:i}else k===i&&(He=A,k=l),k===l?B===":".charCodeAt(0)&&(de=A+1,k=T):k===T&&(k=$)}}},Ue=function(C){if(K===ee||K===z)K=Te,M!==0&&(S(M),M=0),M=c(function(){we()},v),v=xe(Math.min(s*16,v*2)),e.readyState=z;else if(K===fe&&C!=null){console.error(C);var b=new Ce("error",{error:C});e.dispatchEvent(b),he(e,e.onerror,b)}},Me=function(){K=fe,U!=null&&(U.abort(),U=void 0),M!==0&&(S(M),M=0),e.readyState=fe},we=function(){if(M=0,K!==Te){if(!h&&U!=null)Ue(new Error("No activity within "+u+" milliseconds. "+(K===z?"No response received.":E+" chars received.")+" Reconnecting.")),U!=null&&(U.abort(),U=void 0);else{var C=Math.max((h||Date.now())+u-Date.now(),1);h=!1,M=c(function(){we()},C)}return}h=!1,E=0,M=c(function(){we()},u),K=z,pe="",ne="",Oe=m,Ae="",He=0,de=0,k=i;var b=n;if(n.slice(0,5)!=="data:"&&n.slice(0,5)!=="blob:"&&m!==""){var G=n.indexOf("?");b=G===-1?n:n.slice(0,G+1)+n.slice(G+1).replace(/(?:^|&)([^=&]*)(?:=[^&]*)?/g,function(ie,ge){return ge===f?"":ie}),b+=(n.indexOf("?")===-1?"?":"&")+f+"="+encodeURIComponent(m)}var B=e.withCredentials,L={};L.Accept="text/event-stream";var A=e.headers;if(A!=null)for(var re in A)Object.prototype.hasOwnProperty.call(A,re)&&(L[re]=A[re]);try{U=be.open(te,ze,Qe,Ue,b,B,L)}catch(ie){throw Me(),ie}};e.url=n,e.readyState=z,e.withCredentials=t,e.headers=d,e._close=Me,we()}q.prototype=Object.create(I.prototype),q.prototype.CONNECTING=z,q.prototype.OPEN=ee,q.prototype.CLOSED=fe,q.prototype.close=function(){this._close()},q.CONNECTING=z,q.OPEN=ee,q.CLOSED=fe,q.prototype.withCredentials=void 0;var Pe=_;p!=null&&(_==null||!("withCredentials"in _.prototype))&&(Pe=q),function(e){if(typeof Fe=="object"&&typeof Fe.exports=="object"){var n=e(Le);n!==void 0&&(Fe.exports=n)}else typeof define=="function"&&define.amd?define(["exports"],e):e(a)}(function(e){e.EventSourcePolyfill=q,e.NativeEventSource=_,e.EventSource=Pe})})(typeof globalThis=="undefined"?typeof window!="undefined"?window:typeof self!="undefined"?self:Le:globalThis)});Ge(exports);at(exports,{Event:()=>y,initialize:()=>ct});var Ke=ke(require("jwt-decode")),Xe=ke(require("mitt")),qe=ke(Be());var y;(function(a){a.READY="ready",a.CONNECTED="connected",a.DISCONNECTED="disconnected",a.CHANGED="changed",a.ERROR="error",a.ERROR_METRICS="metrics error",a.ERROR_AUTH="auth error",a.ERROR_FETCH_FLAGS="fetch flags error",a.ERROR_FETCH_FLAG="fetch flag error",a.ERROR_STREAM="stream error"})(y||(y={}));var De=6e4,$e={debug:!1,baseUrl:"https://config.ff.harness.io/api/1.0",eventUrl:"https://events.ff.harness.io/api/1.0",eventsSyncInterval:De,streamEnabled:!0,allAttributesPrivate:!1,privateAttributeNames:[]},oe=(a,...c)=>console.error(`[FF-SDK] ${a}`,...c);var st="1.8.0",ft=500,Ne=globalThis.fetch,dt=qe.EventSourcePolyfill,Ve=!!globalThis.Proxy,je=a=>{let{value:c}=a;try{switch(a.kind.toLowerCase()){case"int":case"number":c=Number(c);break;case"boolean":c=c.toString().toLowerCase()==="true";break;case"json":c=JSON.parse(c);break}}catch(S){oe(S)}return c},ct=(a,c,S)=>{let p=!1,Y,W,_,F,V,D=!0,ae={},se=()=>{D=!1},Ee=()=>{D=!0},O=[],g=(0,Xe.default)(),N=J(J({},$e),S);N.eventsSyncInterval<De&&(N.eventsSyncInterval=De);let w=(r,...i)=>{N.debug&&console.debug(`[FF-SDK] ${r}`,...i)},x=r=>{if(D){let i=Date.now();i-r.lastAccessed>ft&&(r.count++,r.lastAccessed=i)}};globalThis.onbeforeunload=()=>{O.length&&globalThis.localStorage&&(se(),globalThis.localStorage.HARNESS_FF_METRICS=JSON.stringify(O),Ee())};let Q=(r,i)=>Ie(void 0,null,function*(){return(yield(yield Ne(`${i.baseUrl}/client/auth`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:r,target:J(J({},c),{identifier:String(c.identifier)})})})).json()).authToken}),ce=0,le=()=>{if(O.length){w("Sending metrics...",{metrics:O,evaluations:H});let r={metricsData:O.map(i=>({timestamp:Date.now(),count:i.count,metricsType:"FFMETRICS",attributes:[{key:"featureIdentifier",value:i.featureIdentifier},{key:"featureName",value:i.featureIdentifier},{key:"variationIdentifier",value:i.variationIdentifier},{key:"target",value:c.identifier},{key:"SDK_NAME",value:"JavaScript"},{key:"SDK_LANGUAGE",value:"JavaScript"},{key:"SDK_TYPE",value:"client"},{key:"SDK_VERSION",value:st}]}))};Ne(`${N.eventUrl}/metrics/${Y}?cluster=${W}`,{method:"POST",headers:J({"Content-Type":"application/json"},ae),body:JSON.stringify(r)}).then(()=>{O=[],ce=0}).catch(i=>{ce++&&(O=[],ce=0),w(i),g.emit(y.ERROR_METRICS,i)}).finally(()=>{V=window.setTimeout(le,N.eventsSyncInterval)})}else V=window.setTimeout(le,N.eventsSyncInterval)},H={},ye=r=>{w("Sending event for",r.flag),Ve?g.emit(y.CHANGED,new Proxy(r,{get(i,l){var T;if(i.hasOwnProperty(l)&&l==="value"){let $=i.flag,j=r.value,P=O.find(X=>X.featureIdentifier===$&&X.featureValue===j);P?(x(P),P.variationIdentifier=((T=H[$])==null?void 0:T.identifier)||""):O.push({featureIdentifier:$,featureValue:String(j),variationIdentifier:H[$].identifier||"",count:D?1:0,lastAccessed:Date.now()}),w("Metrics event: Flag",l,"has been read with value via stream update",j)}return l==="value"?je(r):r[l]}})):g.emit(y.CHANGED,{deleted:r.deleted,flag:r.flag,value:je(r)})},me=function(){return Ve?new Proxy({},{get(r,i){var T,$,j;let l=r[i];if(r.hasOwnProperty(i)){let P=r[i],X=O.find(ve=>ve.featureIdentifier===i&&P===ve.featureValue);X?(X.variationIdentifier=((T=H[i])==null?void 0:T.identifier)||"",x(X)):O.push({featureIdentifier:i,featureValue:P,variationIdentifier:(($=H[i])==null?void 0:$.identifier)||"",count:D?1:0,lastAccessed:Date.now()}),w("Metrics event: Flag:",i,"has been read with value:",P,"variationIdentifier:",(j=H[i])==null?void 0:j.identifier)}return l}}):{}},I=me();Q(a,N).then(r=>{if(p)return;F=r;let i=(0,Ke.default)(r);if(ae={Authorization:`Bearer ${F}`,"Harness-AccountID":i.accountID,"Harness-EnvironmentID":i.environmentIdentifier},w("Authenticated",i),globalThis.localStorage&&globalThis.localStorage.HARNESS_FF_METRICS)try{delete globalThis.localStorage.HARNESS_FF_METRICS,w("Picking up metrics from previous session")}catch(T){}V=window.setTimeout(le,N.eventsSyncInterval),Y=i.environment,W=i.clusterIdentifier;let l=!!Object.keys(H).length;Re().then(()=>{w("Fetch all flags ok",I)}).then(()=>{p||Se()}).then(()=>{p||(w("Event stream ready",{storage:I}),l||g.emit(y.READY,J({},I)))}).catch(T=>{g.emit(y.ERROR,T)})}).catch(r=>{oe("Authentication error: ",r),g.emit(y.ERROR_AUTH,r),g.emit(y.ERROR,r)});let Re=()=>Ie(void 0,null,function*(){try{let r=yield Ne(`${N.baseUrl}/client/env/${Y}/target/${c.identifier}/evaluations?cluster=${W}`,{headers:ae});r.ok?(yield r.json()).forEach(ue):(oe("Features fetch operation error: ",r),g.emit(y.ERROR_FETCH_FLAGS,r),g.emit(y.ERROR,r))}catch(r){return oe("Features fetch operation error: ",r),g.emit(y.ERROR_FETCH_FLAGS,r),g.emit(y.ERROR,r),r}}),Z=r=>Ie(void 0,null,function*(){try{let i=yield Ne(`${N.baseUrl}/client/env/${Y}/target/${c.identifier}/evaluations/${r}?cluster=${W}`,{headers:ae});if(i.ok){let l=yield i.json();ue(l),ye(l)}else oe("Feature fetch operation error: ",i),g.emit(y.ERROR_FETCH_FLAG,i),g.emit(y.ERROR,i)}catch(i){oe("Feature fetch operation error: ",i),g.emit(y.ERROR_FETCH_FLAG,i),g.emit(y.ERROR,i)}}),ue=r=>{se();let i=je(r);i!==I[r.flag]&&(w("Flag variation has changed for ",r.identifier),I[r.flag]=i,H[r.flag]=J(J({},r),{value:i}),ye(r)),Ee()},Se=()=>{if(!N.streamEnabled){w("Stream is disabled by configuration. Note: Polling is not yet supported");return}_=new dt(`${N.baseUrl}/stream?cluster=${W}`,{headers:J({"API-Key":a},ae)}),_.onopen=l=>{w("Stream connected",l),g.emit(y.CONNECTED)},_.onclose=l=>{w("Stream disconnected"),g.emit(y.DISCONNECTED)},_.onerror=l=>{oe("Stream has issue",l),g.emit(y.ERROR_STREAM,l),g.emit(y.ERROR,l)};let r=l=>{switch(l.event){case"create":setTimeout(()=>Z(l.identifier),1e3);break;case"patch":Z(l.identifier);break;case"delete":delete I[l.identifier],g.emit(y.CHANGED,{flag:l.identifier,value:void 0,deleted:!0}),w("Evaluation deleted",{message:l,storage:I});break}},i=l=>{l.event==="patch"&&Re()};_.addEventListener("*",l=>{let T=JSON.parse(l.data);w("Received event from stream: ",T),T.domain==="flag"?r(T):T.domain==="target-segment"&&i(T)})},Ce=(r,i)=>g.on(r,i),Te=(r,i)=>{r?g.off(r,i):ee()},z=(r,i)=>{var T;let l=I[r];if(!Ve&&l!==void 0){let $=l,j=r,P=O.find(X=>X.featureIdentifier===j&&X.featureValue===$);P?(x(P),P.variationIdentifier=((T=H[j])==null?void 0:T.identifier)||""):O.push({featureIdentifier:j,featureValue:$,count:D?1:0,variationIdentifier:H[j].identifier||"",lastAccessed:Date.now()})}return l!==void 0?l:i},ee=()=>{p=!0,w("Closing event stream"),I=me(),H={},clearTimeout(V),g.all.clear(),typeof(_==null?void 0:_.close)=="function"&&_.close()};return{on:Ce,off:Te,variation:z,close:ee,setEvaluations:r=>{if(r.length){let i=!!Object.keys(H).length;r.forEach(ue),i||setTimeout(()=>{g.emit(y.READY,J({},I))},10)}}}};
/** @license
 * eventsource.js
 * Available under MIT License (MIT)
 * https://github.com/Yaffle/EventSource/
 */
