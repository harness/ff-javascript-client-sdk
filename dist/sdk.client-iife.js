var HarnessFFSDK=(()=>{var tt=Object.create,Oe=Object.defineProperty,nt=Object.getPrototypeOf,rt=Object.prototype.hasOwnProperty,it=Object.getOwnPropertyNames,at=Object.getOwnPropertyDescriptor;var W=Object.assign,ot=n=>Oe(n,"__esModule",{value:!0});var st=(n,i)=>()=>(i||(i={exports:{}},n(i.exports,i)),i.exports),ft=(n,i)=>{for(var v in i)Oe(n,v,{get:i[v],enumerable:!0})},dt=(n,i,v)=>{if(i&&typeof i=="object"||typeof i=="function")for(let c of it(i))!rt.call(n,c)&&c!=="default"&&Oe(n,c,{get:()=>i[c],enumerable:!(v=at(i,c))||v.enumerable});return n},ct=n=>dt(ot(Oe(n!=null?tt(nt(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var Ae=(n,i,v)=>new Promise((c,H)=>{var D=$=>{try{L(v.next($))}catch(N){H(N)}},b=$=>{try{L(v.throw($))}catch(N){H(N)}},L=$=>$.done?c($.value):Promise.resolve($.value).then(D,b);L((v=v.apply(n,i)).next())});var Ge=st((Pe,Ne)=>{(function(n){"use strict";var i=n.setTimeout,v=n.clearTimeout,c=n.XMLHttpRequest,H=n.XDomainRequest,D=n.ActiveXObject,b=n.EventSource,L=n.document,$=n.Promise,N=n.fetch,ie=n.Response,ae=n.TextDecoder,ve=n.TextEncoder,w=n.AbortController;if(typeof window!="undefined"&&typeof L!="undefined"&&!("readyState"in L)&&L.body==null&&(L.readyState="loading",window.addEventListener("load",function(e){L.readyState="complete"},!1)),c==null&&D!=null&&(c=function(){return new D("Microsoft.XMLHTTP")}),Object.create==null&&(Object.create=function(e){function r(){}return r.prototype=e,new r}),Date.now||(Date.now=function(){return new Date().getTime()}),w==null){var x=N;N=function(e,r){var a=r.signal;return x(e,{headers:r.headers,credentials:r.credentials,cache:r.cache}).then(function(t){var l=t.body.getReader();return a._reader=l,a._aborted&&a._reader.cancel(),{status:t.status,statusText:t.statusText,headers:t.headers,body:{getReader:function(){return l}}}})},w=function(){this.signal={_reader:null,_aborted:!1},this.abort=function(){this.signal._reader!=null&&this.signal._reader.cancel(),this.signal._aborted=!0}}}function P(){this.bitsNeeded=0,this.codePoint=0}P.prototype.decode=function(e){function r(E,y,u){if(u===1)return E>=128>>y&&E<<y<=2047;if(u===2)return E>=2048>>y&&E<<y<=55295||E>=57344>>y&&E<<y<=65535;if(u===3)return E>=65536>>y&&E<<y<=1114111;throw new Error}function a(E,y){if(E===6*1)return y>>6>15?3:y>31?2:1;if(E===6*2)return y>15?3:2;if(E===6*3)return 3;throw new Error}for(var t=65533,l="",d=this.bitsNeeded,p=this.codePoint,m=0;m<e.length;m+=1){var g=e[m];d!==0&&(g<128||g>191||!r(p<<6|g&63,d-6,a(d,p)))&&(d=0,p=t,l+=String.fromCharCode(p)),d===0?(g>=0&&g<=127?(d=0,p=g):g>=192&&g<=223?(d=6*1,p=g&31):g>=224&&g<=239?(d=6*2,p=g&15):g>=240&&g<=247?(d=6*3,p=g&7):(d=0,p=t),d!==0&&!r(p,d,a(d,p))&&(d=0,p=t)):(d-=6,p=p<<6|g&63),d===0&&(p<=65535?l+=String.fromCharCode(p):(l+=String.fromCharCode(55296+(p-65535-1>>10)),l+=String.fromCharCode(56320+(p-65535-1&1023))))}return this.bitsNeeded=d,this.codePoint=p,l};var R=function(){try{return new ae().decode(new ve().encode("test"),{stream:!0})==="test"}catch(e){console.debug("TextDecoder does not support streaming option. Using polyfill instead: "+e)}return!1};(ae==null||ve==null||!R())&&(ae=P);var k=function(){};function Q(e){this.withCredentials=!1,this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=k,this.onload=k,this.onerror=k,this.onreadystatechange=k,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=k}Q.prototype.open=function(e,r){this._abort(!0);var a=this,t=this._xhr,l=1,d=0;this._abort=function(u){a._sendTimeout!==0&&(v(a._sendTimeout),a._sendTimeout=0),(l===1||l===2||l===3)&&(l=4,t.onload=k,t.onerror=k,t.onabort=k,t.onprogress=k,t.onreadystatechange=k,t.abort(),d!==0&&(v(d),d=0),u||(a.readyState=4,a.onabort(null),a.onreadystatechange())),l=0};var p=function(){if(l===1){var u=0,S="",ee=void 0;if("contentType"in t)u=200,S="OK",ee=t.contentType;else try{u=t.status,S=t.statusText,ee=t.getResponseHeader("Content-Type")}catch(me){u=0,S="",ee=void 0}u!==0&&(l=2,a.readyState=2,a.status=u,a.statusText=S,a._contentType=ee,a.onreadystatechange())}},m=function(){if(p(),l===2||l===3){l=3;var u="";try{u=t.responseText}catch(S){}a.readyState=3,a.responseText=u,a.onprogress()}},g=function(u,S){if((S==null||S.preventDefault==null)&&(S={preventDefault:k}),m(),l===1||l===2||l===3){if(l=4,d!==0&&(v(d),d=0),a.readyState=4,u==="load")a.onload(S);else if(u==="error")a.onerror(S);else if(u==="abort")a.onabort(S);else throw new TypeError;a.onreadystatechange()}},E=function(u){t!=null&&(t.readyState===4?(!("onload"in t)||!("onerror"in t)||!("onabort"in t))&&g(t.responseText===""?"error":"load",u):t.readyState===3?"onprogress"in t||m():t.readyState===2&&p())},y=function(){d=i(function(){y()},500),t.readyState===3&&m()};"onload"in t&&(t.onload=function(u){g("load",u)}),"onerror"in t&&(t.onerror=function(u){g("error",u)}),"onabort"in t&&(t.onabort=function(u){g("abort",u)}),"onprogress"in t&&(t.onprogress=m),"onreadystatechange"in t&&(t.onreadystatechange=function(u){E(u)}),("contentType"in t||!("ontimeout"in c.prototype))&&(r+=(r.indexOf("?")===-1?"?":"&")+"padding=true"),t.open(e,r,!0),"readyState"in t&&(d=i(function(){y()},0))},Q.prototype.abort=function(){this._abort(!1)},Q.prototype.getResponseHeader=function(e){return this._contentType},Q.prototype.setRequestHeader=function(e,r){var a=this._xhr;"setRequestHeader"in a&&a.setRequestHeader(e,r)},Q.prototype.getAllResponseHeaders=function(){return this._xhr.getAllResponseHeaders!=null&&this._xhr.getAllResponseHeaders()||""},Q.prototype.send=function(){if((!("ontimeout"in c.prototype)||!("sendAsBinary"in c.prototype)&&!("mozAnon"in c.prototype))&&L!=null&&L.readyState!=null&&L.readyState!=="complete"){var e=this;e._sendTimeout=i(function(){e._sendTimeout=0,e.send()},4);return}var r=this._xhr;"withCredentials"in r&&(r.withCredentials=this.withCredentials);try{r.send(void 0)}catch(a){throw a}};function se(e){return e.replace(/[A-Z]/g,function(r){return String.fromCharCode(r.charCodeAt(0)+32)})}function fe(e){for(var r=Object.create(null),a=e.split(`\r
`),t=0;t<a.length;t+=1){var l=a[t],d=l.split(": "),p=d.shift(),m=d.join(": ");r[se(p)]=m}this._map=r}fe.prototype.get=function(e){return this._map[se(e)]},c!=null&&c.HEADERS_RECEIVED==null&&(c.HEADERS_RECEIVED=2);function _(){}_.prototype.open=function(e,r,a,t,l,d,p){e.open("GET",l);var m=0;e.onprogress=function(){var E=e.responseText,y=E.slice(m);m+=y.length,a(y)},e.onerror=function(E){E.preventDefault(),t(new Error("NetworkError"))},e.onload=function(){t(null)},e.onabort=function(){t(null)},e.onreadystatechange=function(){if(e.readyState===c.HEADERS_RECEIVED){var E=e.status,y=e.statusText,u=e.getResponseHeader("Content-Type"),S=e.getAllResponseHeaders();r(E,y,u,new fe(S))}},e.withCredentials=d;for(var g in p)Object.prototype.hasOwnProperty.call(p,g)&&e.setRequestHeader(g,p[g]);return e.send(),e};function he(e){this._headers=e}he.prototype.get=function(e){return this._headers.get(e)};function pe(){}pe.prototype.open=function(e,r,a,t,l,d,p){var m=null,g=new w,E=g.signal,y=new ae;return N(l,{headers:p,credentials:d?"include":"same-origin",signal:E,cache:"no-store"}).then(function(u){return m=u.body.getReader(),r(u.status,u.statusText,u.headers.get("Content-Type"),new he(u.headers)),new $(function(S,ee){var me=function(){m.read().then(function(G){if(G.done)S(void 0);else{var j=y.decode(G.value,{stream:!0});a(j),me()}}).catch(function(G){ee(G)})};me()})}).catch(function(u){if(u.name!=="AbortError")return u}).then(function(u){t(u)}),{abort:function(){m!=null&&m.cancel(),g.abort()}}};function O(){this._listeners=Object.create(null)}function ge(e){i(function(){throw e},0)}O.prototype.dispatchEvent=function(e){e.target=this;var r=this._listeners[e.type];if(r!=null)for(var a=r.length,t=0;t<a;t+=1){var l=r[t];try{typeof l.handleEvent=="function"?l.handleEvent(e):l.call(this,e)}catch(d){ge(d)}}},O.prototype.addEventListener=function(e,r){e=String(e);var a=this._listeners,t=a[e];t==null&&(t=[],a[e]=t);for(var l=!1,d=0;d<t.length;d+=1)t[d]===r&&(l=!0);l||t.push(r)},O.prototype.removeEventListener=function(e,r){e=String(e);var a=this._listeners,t=a[e];if(t!=null){for(var l=[],d=0;d<t.length;d+=1)t[d]!==r&&l.push(t[d]);l.length===0?delete a[e]:a[e]=l}};function Z(e){this.type=e,this.target=void 0}function be(e,r){Z.call(this,e),this.data=r.data,this.lastEventId=r.lastEventId}be.prototype=Object.create(Z.prototype);function Ee(e,r){Z.call(this,e),this.status=r.status,this.statusText=r.statusText,this.headers=r.headers}Ee.prototype=Object.create(Z.prototype);function Te(e,r){Z.call(this,e),this.error=r.error}Te.prototype=Object.create(Z.prototype);var ye=-1,Y=0,s=1,f=2,o=-1,h=0,T=1,C=2,F=3,K=/^text\/event\-stream(;.*)?$/i,Ce=1e3,We=18e6,Me=function(e,r){var a=e==null?r:parseInt(e,10);return a!==a&&(a=r),Ve(a)},Ve=function(e){return Math.min(Math.max(e,Ce),We)},de=function(e,r,a){try{typeof r=="function"&&r.call(e,a)}catch(t){ge(t)}};function z(e,r){O.call(this),r=r||{},this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this.headers=void 0,this._close=void 0,Qe(this,e,r)}function Ye(){return c!=null&&"withCredentials"in c.prototype||H==null?new c:new H}var ze=N!=null&&ie!=null&&"body"in ie.prototype;function Qe(e,r,a){r=String(r);var t=Boolean(a.withCredentials),l=a.lastEventIdQueryParameterName||"lastEventId",d=Ve(1e3),p=Me(a.heartbeatTimeout,45e3),m="",g=d,E=!1,y=0,u=a.headers||{},S=a.Transport,ee=ze&&S==null?void 0:new Q(S!=null?new S:Ye()),me=S!=null&&typeof S!="string"?new S:ee==null?new pe:new _,G=void 0,j=0,J=ye,ce="",Ie="",te="",Re="",U=h,He=0,oe=0,Ze=function(A,I,X,q){if(J===Y)if(A===200&&X!=null&&K.test(X)){J=s,E=Date.now(),g=d,e.readyState=s;var B=new Ee("open",{status:A,statusText:I,headers:q});e.dispatchEvent(B),de(e,e.onopen,B)}else{var M="";A!==200?(I&&(I=I.replace(/\s+/g," ")),M="EventSource's response has a status "+A+" "+I+" that is not 200. Aborting the connection."):M="EventSource's response has a Content-Type specifying an unsupported type: "+(X==null?"-":X.replace(/\s+/g," "))+". Aborting the connection.",ke();var B=new Ee("error",{status:A,statusText:I,headers:q});e.dispatchEvent(B),de(e,e.onerror,B),console.error(M)}},et=function(A){if(J===s){for(var I=-1,X=0;X<A.length;X+=1){var q=A.charCodeAt(X);(q===`
`.charCodeAt(0)||q==="\r".charCodeAt(0))&&(I=X)}var B=(I!==-1?Re:"")+A.slice(0,I+1);Re=(I===-1?Re:"")+A.slice(I+1),A!==""&&(E=Date.now(),y+=A.length);for(var M=0;M<B.length;M+=1){var q=B.charCodeAt(M);if(U===o&&q===`
`.charCodeAt(0))U=h;else if(U===o&&(U=h),q==="\r".charCodeAt(0)||q===`
`.charCodeAt(0)){if(U!==h){U===T&&(oe=M+1);var ne=B.slice(He,oe-1),re=B.slice(oe+(oe<M&&B.charCodeAt(oe)===" ".charCodeAt(0)?1:0),M);ne==="data"?(ce+=`
`,ce+=re):ne==="id"?Ie=re:ne==="event"?te=re:ne==="retry"?(d=Me(re,d),g=d):ne==="heartbeatTimeout"&&(p=Me(re,p),j!==0&&(v(j),j=i(function(){Se()},p)))}if(U===h){if(ce!==""){m=Ie,te===""&&(te="message");var le=new be(te,{data:ce.slice(1),lastEventId:Ie});if(e.dispatchEvent(le),te==="open"?de(e,e.onopen,le):te==="message"?de(e,e.onmessage,le):te==="error"&&de(e,e.onerror,le),J===f)return}ce="",te=""}U=q==="\r".charCodeAt(0)?o:h}else U===h&&(He=M,U=T),U===T?q===":".charCodeAt(0)&&(oe=M+1,U=C):U===C&&(U=F)}}},Ue=function(A){if(J===s||J===Y)J=ye,j!==0&&(v(j),j=0),j=i(function(){Se()},g),g=Ve(Math.min(d*16,g*2)),e.readyState=Y;else if(J===f&&A!=null){console.error(A);var I=new Te("error",{error:A});e.dispatchEvent(I),de(e,e.onerror,I)}},ke=function(){J=f,G!=null&&(G.abort(),G=void 0),j!==0&&(v(j),j=0),e.readyState=f},Se=function(){if(j=0,J!==ye){if(!E&&G!=null)Ue(new Error("No activity within "+p+" milliseconds. "+(J===Y?"No response received.":y+" chars received.")+" Reconnecting.")),G!=null&&(G.abort(),G=void 0);else{var A=Math.max((E||Date.now())+p-Date.now(),1);E=!1,j=i(function(){Se()},A)}return}E=!1,y=0,j=i(function(){Se()},p),J=Y,ce="",te="",Ie=m,Re="",He=0,oe=0,U=h;var I=r;if(r.slice(0,5)!=="data:"&&r.slice(0,5)!=="blob:"&&m!==""){var X=r.indexOf("?");I=X===-1?r:r.slice(0,X+1)+r.slice(X+1).replace(/(?:^|&)([^=&]*)(?:=[^&]*)?/g,function(re,le){return le===l?"":re}),I+=(r.indexOf("?")===-1?"?":"&")+l+"="+encodeURIComponent(m)}var q=e.withCredentials,B={};B.Accept="text/event-stream";var M=e.headers;if(M!=null)for(var ne in M)Object.prototype.hasOwnProperty.call(M,ne)&&(B[ne]=M[ne]);try{G=me.open(ee,Ze,et,Ue,I,q,B)}catch(re){throw ke(),re}};e.url=r,e.readyState=Y,e.withCredentials=t,e.headers=u,e._close=ke,Se()}z.prototype=Object.create(O.prototype),z.prototype.CONNECTING=Y,z.prototype.OPEN=s,z.prototype.CLOSED=f,z.prototype.close=function(){this._close()},z.CONNECTING=Y,z.OPEN=s,z.CLOSED=f,z.prototype.withCredentials=void 0;var je=b;c!=null&&(b==null||!("withCredentials"in b.prototype))&&(je=z),function(e){if(typeof Ne=="object"&&typeof Ne.exports=="object"){var r=e(Pe);r!==void 0&&(Ne.exports=r)}else typeof define=="function"&&define.amd?define(["exports"],e):e(n)}(function(e){e.EventSourcePolyfill=z,e.NativeEventSource=b,e.EventSource=je})})(typeof globalThis=="undefined"?typeof window!="undefined"?window:typeof self!="undefined"?self:Pe:globalThis)});var vt={};ft(vt,{Event:()=>V,initialize:()=>Je});function Le(n){this.message=n}Le.prototype=new Error,Le.prototype.name="InvalidCharacterError";var Be=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(n){var i=String(n).replace(/=+$/,"");if(i.length%4==1)throw new Le("'atob' failed: The string to be decoded is not correctly encoded.");for(var v,c,H=0,D=0,b="";c=i.charAt(D++);~c&&(v=H%4?64*v+c:c,H++%4)?b+=String.fromCharCode(255&v>>(-2*H&6)):0)c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c);return b};function lt(n){var i=n.replace(/-/g,"+").replace(/_/g,"/");switch(i.length%4){case 0:break;case 2:i+="==";break;case 3:i+="=";break;default:throw"Illegal base64url string!"}try{return function(v){return decodeURIComponent(Be(v).replace(/(.)/g,function(c,H){var D=H.charCodeAt(0).toString(16).toUpperCase();return D.length<2&&(D="0"+D),"%"+D}))}(i)}catch(v){return Be(i)}}function De(n){this.message=n}function ut(n,i){if(typeof n!="string")throw new De("Invalid token specified");var v=(i=i||{}).header===!0?0:1;try{return JSON.parse(lt(n.split(".")[v]))}catch(c){throw new De("Invalid token specified: "+c.message)}}De.prototype=new Error,De.prototype.name="InvalidTokenError";var $e=ut;function Ke(n){return{all:n=n||new Map,on:function(i,v){var c=n.get(i);c&&c.push(v)||n.set(i,[v])},off:function(i,v){var c=n.get(i);c&&c.splice(c.indexOf(v)>>>0,1)},emit:function(i,v){(n.get(i)||[]).slice().map(function(c){c(v)}),(n.get("*")||[]).slice().map(function(c){c(i,v)})}}}var qe=ct(Ge());var V;(function(n){n.READY="ready",n.CONNECTED="connected",n.DISCONNECTED="disconnected",n.CHANGED="changed",n.ERROR="error"})(V||(V={}));var xe=6e4,Xe={debug:!1,baseUrl:"https://config.ff.harness.io/api/1.0",eventUrl:"https://events.ff.harness.io/api/1.0",eventsSyncInterval:xe,streamEnabled:!0,allAttributesPrivate:!1,privateAttributeNames:[]},ue=(n,...i)=>console.error(`[FF-SDK] ${n}`,...i);var ht="1.7.0",pt=500,_e=globalThis.fetch,gt=qe.EventSourcePolyfill,we=!!globalThis.Proxy,Fe=n=>{let{value:i}=n;try{switch(n.kind.toLowerCase()){case"int":case"number":i=Number(i);break;case"boolean":i=i.toString().toLowerCase()==="true";break;case"json":i=JSON.parse(i);break}}catch(v){ue(v)}return i},Je=(n,i,v)=>{let c=!1,H,D,b,L,$,N=!0,ie={},ae=()=>{N=!1},ve=()=>{N=!0},w=[],x=Ke(),P=W(W({},Xe),v);P.eventsSyncInterval<xe&&(P.eventsSyncInterval=xe);let R=(s,...f)=>{P.debug&&console.debug(`[FF-SDK] ${s}`,...f)},k=s=>{if(N){let f=Date.now();f-s.lastAccessed>pt&&(s.count++,s.lastAccessed=f)}};globalThis.onbeforeunload=()=>{w.length&&globalThis.localStorage&&(ae(),globalThis.localStorage.HARNESS_FF_METRICS=JSON.stringify(w),ve())};let Q=(s,f)=>Ae(void 0,null,function*(){return(yield(yield _e(`${f.baseUrl}/client/auth`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:s,target:W(W({},i),{identifier:String(i.identifier)})})})).json()).authToken}),se=0,fe=()=>{if(w.length){R("Sending metrics...",{metrics:w,evaluations:_});let s={metricsData:w.map(f=>({timestamp:Date.now(),count:f.count,metricsType:"FFMETRICS",attributes:[{key:"featureIdentifier",value:f.featureIdentifier},{key:"featureName",value:f.featureIdentifier},{key:"variationIdentifier",value:f.variationIdentifier},{key:"target",value:i.identifier},{key:"SDK_NAME",value:"JavaScript"},{key:"SDK_LANGUAGE",value:"JavaScript"},{key:"SDK_TYPE",value:"client"},{key:"SDK_VERSION",value:ht}]}))};_e(`${P.eventUrl}/metrics/${H}?cluster=${D}`,{method:"POST",headers:W({"Content-Type":"application/json"},ie),body:JSON.stringify(s)}).then(()=>{w=[],se=0}).catch(f=>{se++&&(w=[],se=0),R(f)}).finally(()=>{$=window.setTimeout(fe,P.eventsSyncInterval)})}else $=window.setTimeout(fe,P.eventsSyncInterval)},_={},he=s=>{R("Sending event for",s.flag),we?x.emit(V.CHANGED,new Proxy(s,{get(f,o){var h;if(f.hasOwnProperty(o)&&o==="value"){let T=f.flag,C=s.value,F=w.find(K=>K.featureIdentifier===T&&K.featureValue===C);F?(k(F),F.variationIdentifier=((h=_[T])==null?void 0:h.identifier)||""):w.push({featureIdentifier:T,featureValue:String(C),variationIdentifier:_[T].identifier||"",count:N?1:0,lastAccessed:Date.now()}),R("Metrics event: Flag",o,"has been read with value via stream update",C)}return o==="value"?Fe(s):s[o]}})):x.emit(V.CHANGED,{deleted:s.deleted,flag:s.flag,value:Fe(s)})},pe=function(){return we?new Proxy({},{get(s,f){var h,T,C;let o=s[f];if(s.hasOwnProperty(f)){let F=s[f],K=w.find(Ce=>Ce.featureIdentifier===f&&F===Ce.featureValue);K?(K.variationIdentifier=((h=_[f])==null?void 0:h.identifier)||"",k(K)):w.push({featureIdentifier:f,featureValue:F,variationIdentifier:((T=_[f])==null?void 0:T.identifier)||"",count:N?1:0,lastAccessed:Date.now()}),R("Metrics event: Flag:",f,"has been read with value:",F,"variationIdentifier:",(C=_[f])==null?void 0:C.identifier)}return o}}):{}},O=pe();Q(n,P).then(s=>{if(c)return;L=s;let f=$e(s);if(ie={Authorization:`Bearer ${L}`,"Harness-AccountID":f.accountID,"Harness-EnvironmentID":f.environmentIdentifier},R("Authenticated",f),globalThis.localStorage&&globalThis.localStorage.HARNESS_FF_METRICS)try{delete globalThis.localStorage.HARNESS_FF_METRICS,R("Picking up metrics from previous session")}catch(o){}$=window.setTimeout(fe,P.eventsSyncInterval),H=f.environment,D=f.clusterIdentifier,ge().then(()=>{R("Fetch all flags ok",O)}).then(()=>{c||be()}).then(()=>{c||(R("Event stream ready",{storage:O}),x.emit(V.READY,W({},O)),we||Object.keys(O).forEach(o=>{var h;w.push({featureIdentifier:o,featureValue:O[o],variationIdentifier:((h=_[o])==null?void 0:h.identifier)||"",count:N?1:0,lastAccessed:Date.now()})}))}).catch(o=>{x.emit(V.ERROR,o)})}).catch(s=>{ue("Authentication error: ",s),x.emit(V.ERROR,s)});let ge=()=>Ae(void 0,null,function*(){try{(yield(yield _e(`${P.baseUrl}/client/env/${H}/target/${i.identifier}/evaluations?cluster=${D}`,{headers:ie})).json()).forEach(o=>{let h=Fe(o),T=O[o.flag];h!==T&&(R("Flag variation has changed for ",o.identifier),O[o.flag]=h,_[o.flag]=W(W({},o),{value:h}),he(o))})}catch(s){return ue("Features fetch operation error: ",s),x.emit(V.ERROR,s),s}}),Z=s=>Ae(void 0,null,function*(){var f;try{let o=yield _e(`${P.baseUrl}/client/env/${H}/target/${i.identifier}/evaluations/${s}?cluster=${D}`,{headers:ie});if(o.ok){let h=yield o.json(),T=Fe(h);if(ae(),O[s]=T,_[s]=W(W({},h),{value:T}),ve(),he(h),!we){let C=h.flag,F=w.find(K=>K.featureIdentifier===C&&K.featureValue===h.value);F?(k(F),F.variationIdentifier=((f=_[C])==null?void 0:f.identifier)||""):w.push({featureIdentifier:C,featureValue:String(h.value),variationIdentifier:_[C].identifier||"",count:N?1:0,lastAccessed:Date.now()})}}else x.emit(V.ERROR,o)}catch(o){ue("Feature fetch operation error: ",o),x.emit(V.ERROR,o)}}),be=()=>{if(!P.streamEnabled){R("Stream is disabled by configuration. Note: Polling is not yet supported");return}b=new gt(`${P.baseUrl}/stream?cluster=${D}`,{headers:W({"API-Key":n},ie)}),b.onopen=o=>{R("Stream connected",o),x.emit(V.CONNECTED)},b.onclose=o=>{R("Stream disconnected"),x.emit(V.DISCONNECTED)},b.onerror=o=>{ue("Stream has issue",o),x.emit(V.ERROR,o)};let s=o=>{switch(o.event){case"create":setTimeout(()=>Z(o.identifier),1e3);break;case"patch":Z(o.identifier);break;case"delete":delete O[o.identifier],x.emit(V.CHANGED,{flag:o.identifier,value:void 0,deleted:!0}),R("Evaluation deleted",{message:o,storage:O});break}},f=o=>{o.event==="patch"&&ge()};b.addEventListener("*",o=>{let h=JSON.parse(o.data);R("Received event from stream: ",h),h.domain==="flag"?s(h):h.domain==="target-segment"&&f(h)})},Ee=(s,f)=>x.on(s,f),Te=(s,f)=>{s?x.off(s,f):Y()},ye=(s,f)=>{var h;let o=O[s];if(!we&&o!==void 0){let T=o,C=s,F=w.find(K=>K.featureIdentifier===C&&K.featureValue===T);F?(k(F),F.variationIdentifier=((h=_[C])==null?void 0:h.identifier)||""):w.push({featureIdentifier:C,featureValue:T,count:N?1:0,variationIdentifier:_[C].identifier||"",lastAccessed:Date.now()})}return o!==void 0?o:f},Y=()=>{c=!0,R("Closing event stream"),O=pe(),_={},clearTimeout($),x.all.clear(),typeof(b==null?void 0:b.close)=="function"&&b.close()};return{on:Ee,off:Te,variation:ye,close:Y}};return vt;})();
/** @license
 * eventsource.js
 * Available under MIT License (MIT)
 * https://github.com/Yaffle/EventSource/
 */
