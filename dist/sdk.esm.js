var rt=Object.create,Me=Object.defineProperty,nt=Object.getPrototypeOf,it=Object.prototype.hasOwnProperty,at=Object.getOwnPropertyNames,ot=Object.getOwnPropertyDescriptor;var W=Object.assign,st=n=>Me(n,"__esModule",{value:!0});var ft=(n,d)=>()=>(d||(d={exports:{}},n(d.exports,d)),d.exports);var dt=(n,d,E)=>{if(d&&typeof d=="object"||typeof d=="function")for(let h of at(d))!it.call(n,h)&&h!=="default"&&Me(n,h,{get:()=>d[h],enumerable:!(E=ot(d,h))||E.enumerable});return n},ct=n=>dt(st(Me(n!=null?rt(nt(n)):{},"default",n&&n.__esModule&&"default"in n?{get:()=>n.default,enumerable:!0}:{value:n,enumerable:!0})),n);var Oe=(n,d,E)=>new Promise((h,q)=>{var J=j=>{try{R(E.next(j))}catch(D){q(D)}},_=j=>{try{R(E.throw(j))}catch(D){q(D)}},R=j=>j.done?h(j.value):Promise.resolve(j.value).then(J,_);R((E=E.apply(n,d)).next())});var Ue=ft((He,Ae)=>{(function(n){"use strict";var d=n.setTimeout,E=n.clearTimeout,h=n.XMLHttpRequest,q=n.XDomainRequest,J=n.ActiveXObject,_=n.EventSource,R=n.document,j=n.Promise,D=n.fetch,ve=n.Response,ie=n.TextDecoder,O=n.TextEncoder,T=n.AbortController;if(typeof window!="undefined"&&typeof R!="undefined"&&!("readyState"in R)&&R.body==null&&(R.readyState="loading",window.addEventListener("load",function(e){R.readyState="complete"},!1)),h==null&&J!=null&&(h=function(){return new J("Microsoft.XMLHTTP")}),Object.create==null&&(Object.create=function(e){function r(){}return r.prototype=e,new r}),Date.now||(Date.now=function(){return new Date().getTime()}),T==null){var Y=D;D=function(e,r){var a=r.signal;return Y(e,{headers:r.headers,credentials:r.credentials,cache:r.cache}).then(function(t){var c=t.body.getReader();return a._reader=c,a._aborted&&a._reader.cancel(),{status:t.status,statusText:t.statusText,headers:t.headers,body:{getReader:function(){return c}}}})},T=function(){this.signal={_reader:null,_aborted:!1},this.abort=function(){this.signal._reader!=null&&this.signal._reader.cancel(),this.signal._aborted=!0}}}function x(){this.bitsNeeded=0,this.codePoint=0}x.prototype.decode=function(e){function r(g,m,l){if(l===1)return g>=128>>m&&g<<m<=2047;if(l===2)return g>=2048>>m&&g<<m<=55295||g>=57344>>m&&g<<m<=65535;if(l===3)return g>=65536>>m&&g<<m<=1114111;throw new Error}function a(g,m){if(g===6*1)return m>>6>15?3:m>31?2:1;if(g===6*2)return m>15?3:2;if(g===6*3)return 3;throw new Error}for(var t=65533,c="",f=this.bitsNeeded,u=this.codePoint,S=0;S<e.length;S+=1){var v=e[S];f!==0&&(v<128||v>191||!r(u<<6|v&63,f-6,a(f,u)))&&(f=0,u=t,c+=String.fromCharCode(u)),f===0?(v>=0&&v<=127?(f=0,u=v):v>=192&&v<=223?(f=6*1,u=v&31):v>=224&&v<=239?(f=6*2,u=v&15):v>=240&&v<=247?(f=6*3,u=v&7):(f=0,u=t),f!==0&&!r(u,f,a(f,u))&&(f=0,u=t)):(f-=6,u=u<<6|v&63),f===0&&(u<=65535?c+=String.fromCharCode(u):(c+=String.fromCharCode(55296+(u-65535-1>>10)),c+=String.fromCharCode(56320+(u-65535-1&1023))))}return this.bitsNeeded=f,this.codePoint=u,c};var oe=function(){try{return new ie().decode(new O().encode("test"),{stream:!0})==="test"}catch(e){console.debug("TextDecoder does not support streaming option. Using polyfill instead: "+e)}return!1};(ie==null||O==null||!oe())&&(ie=x);var $=function(){};function z(e){this.withCredentials=!1,this.readyState=0,this.status=0,this.statusText="",this.responseText="",this.onprogress=$,this.onload=$,this.onerror=$,this.onreadystatechange=$,this._contentType="",this._xhr=e,this._sendTimeout=0,this._abort=$}z.prototype.open=function(e,r){this._abort(!0);var a=this,t=this._xhr,c=1,f=0;this._abort=function(l){a._sendTimeout!==0&&(E(a._sendTimeout),a._sendTimeout=0),(c===1||c===2||c===3)&&(c=4,t.onload=$,t.onerror=$,t.onabort=$,t.onprogress=$,t.onreadystatechange=$,t.abort(),f!==0&&(E(f),f=0),l||(a.readyState=4,a.onabort(null),a.onreadystatechange())),c=0};var u=function(){if(c===1){var l=0,b="",Q=void 0;if("contentType"in t)l=200,b="OK",Q=t.contentType;else try{l=t.status,b=t.statusText,Q=t.getResponseHeader("Content-Type")}catch(Ee){l=0,b="",Q=void 0}l!==0&&(c=2,a.readyState=2,a.status=l,a.statusText=b,a._contentType=Q,a.onreadystatechange())}},S=function(){if(u(),c===2||c===3){c=3;var l="";try{l=t.responseText}catch(b){}a.readyState=3,a.responseText=l,a.onprogress()}},v=function(l,b){if((b==null||b.preventDefault==null)&&(b={preventDefault:$}),S(),c===1||c===2||c===3){if(c=4,f!==0&&(E(f),f=0),a.readyState=4,l==="load")a.onload(b);else if(l==="error")a.onerror(b);else if(l==="abort")a.onabort(b);else throw new TypeError;a.onreadystatechange()}},g=function(l){t!=null&&(t.readyState===4?(!("onload"in t)||!("onerror"in t)||!("onabort"in t))&&v(t.responseText===""?"error":"load",l):t.readyState===3?"onprogress"in t||S():t.readyState===2&&u())},m=function(){f=d(function(){m()},500),t.readyState===3&&S()};"onload"in t&&(t.onload=function(l){v("load",l)}),"onerror"in t&&(t.onerror=function(l){v("error",l)}),"onabort"in t&&(t.onabort=function(l){v("abort",l)}),"onprogress"in t&&(t.onprogress=S),"onreadystatechange"in t&&(t.onreadystatechange=function(l){g(l)}),("contentType"in t||!("ontimeout"in h.prototype))&&(r+=(r.indexOf("?")===-1?"?":"&")+"padding=true"),t.open(e,r,!0),"readyState"in t&&(f=d(function(){m()},0))},z.prototype.abort=function(){this._abort(!1)},z.prototype.getResponseHeader=function(e){return this._contentType},z.prototype.setRequestHeader=function(e,r){var a=this._xhr;"setRequestHeader"in a&&a.setRequestHeader(e,r)},z.prototype.getAllResponseHeaders=function(){return this._xhr.getAllResponseHeaders!=null&&this._xhr.getAllResponseHeaders()||""},z.prototype.send=function(){if((!("ontimeout"in h.prototype)||!("sendAsBinary"in h.prototype)&&!("mozAnon"in h.prototype))&&R!=null&&R.readyState!=null&&R.readyState!=="complete"){var e=this;e._sendTimeout=d(function(){e._sendTimeout=0,e.send()},4);return}var r=this._xhr;"withCredentials"in r&&(r.withCredentials=this.withCredentials);try{r.send(void 0)}catch(a){throw a}};function N(e){return e.replace(/[A-Z]/g,function(r){return String.fromCharCode(r.charCodeAt(0)+32)})}function pe(e){for(var r=Object.create(null),a=e.split(`\r
`),t=0;t<a.length;t+=1){var c=a[t],f=c.split(": "),u=f.shift(),S=f.join(": ");r[N(u)]=S}this._map=r}pe.prototype.get=function(e){return this._map[N(e)]},h!=null&&h.HEADERS_RECEIVED==null&&(h.HEADERS_RECEIVED=2);function he(){}he.prototype.open=function(e,r,a,t,c,f,u){e.open("GET",c);var S=0;e.onprogress=function(){var g=e.responseText,m=g.slice(S);S+=m.length,a(m)},e.onerror=function(g){g.preventDefault(),t(new Error("NetworkError"))},e.onload=function(){t(null)},e.onabort=function(){t(null)},e.onreadystatechange=function(){if(e.readyState===h.HEADERS_RECEIVED){var g=e.status,m=e.statusText,l=e.getResponseHeader("Content-Type"),b=e.getAllResponseHeaders();r(g,m,l,new pe(b))}},e.withCredentials=f;for(var v in u)Object.prototype.hasOwnProperty.call(u,v)&&e.setRequestHeader(v,u[v]);return e.send(),e};function V(e){this._headers=e}V.prototype.get=function(e){return this._headers.get(e)};function ge(){}ge.prototype.open=function(e,r,a,t,c,f,u){var S=null,v=new T,g=v.signal,m=new ie;return D(c,{headers:u,credentials:f?"include":"same-origin",signal:g,cache:"no-store"}).then(function(l){return S=l.body.getReader(),r(l.status,l.statusText,l.headers.get("Content-Type"),new V(l.headers)),new j(function(b,Q){var Ee=function(){S.read().then(function(U){if(U.done)b(void 0);else{var M=m.decode(U.value,{stream:!0});a(M),Ee()}}).catch(function(U){Q(U)})};Ee()})}).catch(function(l){if(l.name!=="AbortError")return l}).then(function(l){t(l)}),{abort:function(){S!=null&&S.cancel(),v.abort()}}};function re(){this._listeners=Object.create(null)}function be(e){d(function(){throw e},0)}re.prototype.dispatchEvent=function(e){e.target=this;var r=this._listeners[e.type];if(r!=null)for(var a=r.length,t=0;t<a;t+=1){var c=r[t];try{typeof c.handleEvent=="function"?c.handleEvent(e):c.call(this,e)}catch(f){be(f)}}},re.prototype.addEventListener=function(e,r){e=String(e);var a=this._listeners,t=a[e];t==null&&(t=[],a[e]=t);for(var c=!1,f=0;f<t.length;f+=1)t[f]===r&&(c=!0);c||t.push(r)},re.prototype.removeEventListener=function(e,r){e=String(e);var a=this._listeners,t=a[e];if(t!=null){for(var c=[],f=0;f<t.length;f+=1)t[f]!==r&&c.push(t[f]);c.length===0?delete a[e]:a[e]=c}};function ne(e){this.type=e,this.target=void 0}function we(e,r){ne.call(this,e),this.data=r.data,this.lastEventId=r.lastEventId}we.prototype=Object.create(ne.prototype);function me(e,r){ne.call(this,e),this.status=r.status,this.statusText=r.statusText,this.headers=r.headers}me.prototype=Object.create(ne.prototype);function Te(e,r){ne.call(this,e),this.error=r.error}Te.prototype=Object.create(ne.prototype);var se=-1,o=0,s=1,i=2,p=-1,y=0,w=1,A=2,k=3,xe=/^text\/event\-stream(;.*)?$/i,Je=1e3,We=18e6,Fe=function(e,r){var a=e==null?r:parseInt(e,10);return a!==a&&(a=r),_e(a)},_e=function(e){return Math.min(Math.max(e,Je),We)},fe=function(e,r,a){try{typeof r=="function"&&r.call(e,a)}catch(t){be(t)}};function X(e,r){re.call(this),r=r||{},this.onopen=void 0,this.onmessage=void 0,this.onerror=void 0,this.url=void 0,this.readyState=void 0,this.withCredentials=void 0,this.headers=void 0,this._close=void 0,Ze(this,e,r)}function Ye(){return h!=null&&"withCredentials"in h.prototype||q==null?new h:new q}var Qe=D!=null&&ve!=null&&"body"in ve.prototype;function Ze(e,r,a){r=String(r);var t=Boolean(a.withCredentials),c=a.lastEventIdQueryParameterName||"lastEventId",f=_e(1e3),u=Fe(a.heartbeatTimeout,45e3),S="",v=f,g=!1,m=0,l=a.headers||{},b=a.Transport,Q=Qe&&b==null?void 0:new z(b!=null?new b:Ye()),Ee=b!=null&&typeof b!="string"?new b:Q==null?new ge:new he,U=void 0,M=0,G=se,de="",Ce="",Z="",Re="",H=y,Pe=0,ae=0,et=function(I,C,B,K){if(G===o)if(I===200&&B!=null&&xe.test(B)){G=s,g=Date.now(),v=f,e.readyState=s;var L=new me("open",{status:I,statusText:C,headers:K});e.dispatchEvent(L),fe(e,e.onopen,L)}else{var F="";I!==200?(C&&(C=C.replace(/\s+/g," ")),F="EventSource's response has a status "+I+" "+C+" that is not 200. Aborting the connection."):F="EventSource's response has a Content-Type specifying an unsupported type: "+(B==null?"-":B.replace(/\s+/g," "))+". Aborting the connection.",Ve();var L=new me("error",{status:I,statusText:C,headers:K});e.dispatchEvent(L),fe(e,e.onerror,L),console.error(F)}},tt=function(I){if(G===s){for(var C=-1,B=0;B<I.length;B+=1){var K=I.charCodeAt(B);(K===`
`.charCodeAt(0)||K==="\r".charCodeAt(0))&&(C=B)}var L=(C!==-1?Re:"")+I.slice(0,C+1);Re=(C===-1?Re:"")+I.slice(C+1),I!==""&&(g=Date.now(),m+=I.length);for(var F=0;F<L.length;F+=1){var K=L.charCodeAt(F);if(H===p&&K===`
`.charCodeAt(0))H=y;else if(H===p&&(H=y),K==="\r".charCodeAt(0)||K===`
`.charCodeAt(0)){if(H!==y){H===w&&(ae=F+1);var ee=L.slice(Pe,ae-1),te=L.slice(ae+(ae<F&&L.charCodeAt(ae)===" ".charCodeAt(0)?1:0),F);ee==="data"?(de+=`
`,de+=te):ee==="id"?Ce=te:ee==="event"?Z=te:ee==="retry"?(f=Fe(te,f),v=f):ee==="heartbeatTimeout"&&(u=Fe(te,u),M!==0&&(E(M),M=d(function(){ye()},u)))}if(H===y){if(de!==""){S=Ce,Z===""&&(Z="message");var ce=new we(Z,{data:de.slice(1),lastEventId:Ce});if(e.dispatchEvent(ce),Z==="open"?fe(e,e.onopen,ce):Z==="message"?fe(e,e.onmessage,ce):Z==="error"&&fe(e,e.onerror,ce),G===i)return}de="",Z=""}H=K==="\r".charCodeAt(0)?p:y}else H===y&&(Pe=F,H=w),H===w?K===":".charCodeAt(0)&&(ae=F+1,H=A):H===A&&(H=k)}}},$e=function(I){if(G===s||G===o)G=se,M!==0&&(E(M),M=0),M=d(function(){ye()},v),v=_e(Math.min(f*16,v*2)),e.readyState=o;else if(G===i&&I!=null){console.error(I);var C=new Te("error",{error:I});e.dispatchEvent(C),fe(e,e.onerror,C)}},Ve=function(){G=i,U!=null&&(U.abort(),U=void 0),M!==0&&(E(M),M=0),e.readyState=i},ye=function(){if(M=0,G!==se){if(!g&&U!=null)$e(new Error("No activity within "+u+" milliseconds. "+(G===o?"No response received.":m+" chars received.")+" Reconnecting.")),U!=null&&(U.abort(),U=void 0);else{var I=Math.max((g||Date.now())+u-Date.now(),1);g=!1,M=d(function(){ye()},I)}return}g=!1,m=0,M=d(function(){ye()},u),G=o,de="",Z="",Ce=S,Re="",Pe=0,ae=0,H=y;var C=r;if(r.slice(0,5)!=="data:"&&r.slice(0,5)!=="blob:"&&S!==""){var B=r.indexOf("?");C=B===-1?r:r.slice(0,B+1)+r.slice(B+1).replace(/(?:^|&)([^=&]*)(?:=[^&]*)?/g,function(te,ce){return ce===c?"":te}),C+=(r.indexOf("?")===-1?"?":"&")+c+"="+encodeURIComponent(S)}var K=e.withCredentials,L={};L.Accept="text/event-stream";var F=e.headers;if(F!=null)for(var ee in F)Object.prototype.hasOwnProperty.call(F,ee)&&(L[ee]=F[ee]);try{U=Ee.open(Q,et,tt,$e,C,K,L)}catch(te){throw Ve(),te}};e.url=r,e.readyState=o,e.withCredentials=t,e.headers=l,e._close=Ve,ye()}X.prototype=Object.create(re.prototype),X.prototype.CONNECTING=o,X.prototype.OPEN=s,X.prototype.CLOSED=i,X.prototype.close=function(){this._close()},X.CONNECTING=o,X.OPEN=s,X.CLOSED=i,X.prototype.withCredentials=void 0;var ke=_;h!=null&&(_==null||!("withCredentials"in _.prototype))&&(ke=X),function(e){if(typeof Ae=="object"&&typeof Ae.exports=="object"){var r=e(He);r!==void 0&&(Ae.exports=r)}else typeof define=="function"&&define.amd?define(["exports"],e):e(n)}(function(e){e.EventSourcePolyfill=X,e.NativeEventSource=_,e.EventSource=ke})})(typeof globalThis=="undefined"?typeof window!="undefined"?window:typeof self!="undefined"?self:He:globalThis)});var qe=ct(Ue());import ut from"jwt-decode";import vt from"mitt";var P;(function(n){n.READY="ready",n.CONNECTED="connected",n.DISCONNECTED="disconnected",n.CHANGED="changed",n.ERROR="error"})(P||(P={}));var Be={debug:!1,baseUrl:"https://config.ff.harness.io/api/1.0",eventUrl:"https://events.ff.harness.io/api/1.0",streamEnabled:!0,allAttributesPrivate:!1,privateAttributeNames:[]},le=(n,...d)=>console.error(`[FF-SDK] ${n}`,...d),Ie=30*1e3;var ue;(function(n){n.NOOP="noop",n.AMPLITUDE="amplitude"})(ue||(ue={}));var Le=class{initialize(d){console.log(`Initializing provider with ${d.apiKey}`)}experiment(d,E,h){console.log(`Experiment for ${d} with variation ${E} and target ${h.identifier}`)}},Ke=Le;var je=class{experiment(d,E,h){}initialize(d){}},Ge=je;var ze=new Map([[ue.NOOP,new Ke],[ue.AMPLITUDE,new Ge]]),lt=n=>ze[n]||ze[ue.NOOP],Xe=n=>{let d=lt(n.provider);return d!==void 0&&d.initialize(n.config),d};var pt="1.4.14",ht=500,De=globalThis.fetch,gt=qe.EventSourcePolyfill,Se=!!globalThis.Proxy,Ne=n=>{let{value:d}=n;try{switch(n.kind.toLowerCase()){case"int":case"number":d=Number(d);break;case"boolean":d=d.toString().toLowerCase()==="true";break;case"json":d=JSON.parse(d);break}}catch(E){le(E)}return d},mt=(n,d,E)=>{let h=!1,q,J,_,R,j,D=!0,ve=()=>{D=!1},ie=()=>{D=!0},O=[],T=vt(),Y=W(W({},Be),E),x=(o,...s)=>{Y.debug&&console.debug(`[FF-SDK] ${o}`,...s)},oe=o=>{if(D){let s=Date.now();s-o.lastAccessed>ht&&(o.count++,o.lastAccessed=s)}};globalThis.onbeforeunload=()=>{O.length&&globalThis.localStorage&&(ve(),globalThis.localStorage.HARNESS_FF_METRICS=JSON.stringify(O),ie())};let $=(o,s)=>Oe(void 0,null,function*(){return(yield(yield De(`${s.baseUrl}/client/auth`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:o,target:W(W({},d),{identifier:String(d.identifier)})})})).json()).authToken}),z=()=>{if(O.length){x("Sending metrics...",{metrics:O,evaluations:N});let o={metricsData:O.map(s=>({timestamp:Date.now(),count:s.count,metricsType:"FFMETRICS",attributes:[{key:"featureIdentifier",value:s.featureIdentifier},{key:"featureName",value:s.featureIdentifier},{key:"variationIdentifier",value:s.variationIdentifier},{key:"target",value:d.identifier},{key:"SDK_NAME",value:"JavaScript"},{key:"SDK_LANGUAGE",value:"JavaScript"},{key:"SDK_TYPE",value:"client"},{key:"SDK_VERSION",value:pt}]}))};De(`${Y.eventUrl}/metrics/${q}?cluster=${J}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${R}`},body:JSON.stringify(o)}).then(()=>{O=[]}).catch(s=>{x(s)}).finally(()=>{j=window.setTimeout(z,Ie)})}else j=window.setTimeout(z,Ie)},N={},pe=o=>{x("Sending event for",o.flag),Se?T.emit(P.CHANGED,new Proxy(o,{get(s,i){var p;if(s.hasOwnProperty(i)&&i==="value"){let y=s.flag,w=o.value,A=O.find(k=>k.featureIdentifier===y&&k.featureValue===w);A?(oe(A),A.variationIdentifier=((p=N[y])==null?void 0:p.identifier)||""):O.push({featureIdentifier:y,featureValue:String(w),variationIdentifier:N[y].identifier||"",count:D?1:0,lastAccessed:Date.now()}),x("Metrics event: Flag",i,"has been read with value via stream update",w)}return i==="value"?Ne(o):o[i]}})):T.emit(P.CHANGED,{deleted:o.deleted,flag:o.flag,value:Ne(o)})},he=function(){return Se?new Proxy({},{get(o,s){var p,y,w;let i=o[s];if(o.hasOwnProperty(s)){let A=o[s],k=O.find(xe=>xe.featureIdentifier===s&&A===xe.featureValue);k?(k.variationIdentifier=((p=N[s])==null?void 0:p.identifier)||"",oe(k)):O.push({featureIdentifier:s,featureValue:A,variationIdentifier:((y=N[s])==null?void 0:y.identifier)||"",count:D?1:0,lastAccessed:Date.now()}),x("Metrics event: Flag:",s,"has been read with value:",A,"variationIdentifier:",(w=N[s])==null?void 0:w.identifier)}return i}}):{}},V=he();$(n,Y).then(o=>{if(h)return;R=o;let s=ut(o);if(x("Authenticated",s),globalThis.localStorage&&globalThis.localStorage.HARNESS_FF_METRICS)try{delete globalThis.localStorage.HARNESS_FF_METRICS,x("Picking up metrics from previous session")}catch(i){}j=window.setTimeout(z,Ie),q=s.environment,J=s.clusterIdentifier,ge().then(()=>{x("Fetch all flags ok",V)}).then(()=>{h||be()}).then(()=>{h||(x("Event stream ready",{storage:V}),T.emit(P.READY,W({},V)),Se||Object.keys(V).forEach(i=>{var p;O.push({featureIdentifier:i,featureValue:V[i],variationIdentifier:((p=N[i])==null?void 0:p.identifier)||"",count:D?1:0,lastAccessed:Date.now()})}))}).catch(i=>{T.emit(P.ERROR,i)})}).catch(o=>{le("Authentication error: ",o),T.emit(P.ERROR,o)});let ge=()=>Oe(void 0,null,function*(){try{(yield(yield De(`${Y.baseUrl}/client/env/${q}/target/${d.identifier}/evaluations?cluster=${J}`,{headers:{Authorization:`Bearer ${R}`}})).json()).forEach(i=>{let p=Ne(i),y=V[i.flag];p!==y&&(x("Flag variation has changed for ",i.identifier),V[i.flag]=p,N[i.flag]=W(W({},i),{value:p}),pe(i))})}catch(o){return le("Features fetch operation error: ",o),T.emit(P.ERROR,o),o}}),re=o=>Oe(void 0,null,function*(){var s;try{let i=yield De(`${Y.baseUrl}/client/env/${q}/target/${d.identifier}/evaluations/${o}?cluster=${J}`,{headers:{Authorization:`Bearer ${R}`}});if(i.ok){let p=yield i.json(),y=Ne(p);if(ve(),V[o]=y,N[o]=W(W({},p),{value:y}),ie(),pe(p),!Se){let w=p.flag,A=O.find(k=>k.featureIdentifier===w&&k.featureValue===p.value);A?(oe(A),A.variationIdentifier=((s=N[w])==null?void 0:s.identifier)||""):O.push({featureIdentifier:w,featureValue:String(p.value),variationIdentifier:N[w].identifier||"",count:D?1:0,lastAccessed:Date.now()})}}else T.emit(P.ERROR,i)}catch(i){le("Feature fetch operation error: ",i),T.emit(P.ERROR,i)}}),be=()=>{if(!Y.streamEnabled){x("Stream is disabled by configuration. Note: Polling is not yet supported");return}_=new gt(`${Y.baseUrl}/stream?cluster=${J}`,{headers:{Authorization:`Bearer ${R}`,"API-Key":n}}),_.onopen=i=>{x("Stream connected",i),T.emit(P.CONNECTED)},_.onclose=i=>{x("Stream disconnected"),T.emit(P.DISCONNECTED)},_.onerror=i=>{le("Stream has issue",i),T.emit(P.ERROR,i)};let o=i=>{switch(i.event){case"create":setTimeout(()=>re(i.identifier),1e3);break;case"patch":re(i.identifier);break;case"delete":delete V[i.identifier],T.emit(P.CHANGED,{flag:i.identifier,value:void 0,deleted:!0}),x("Evaluation deleted",{message:i,storage:V});break}},s=i=>{i.event==="patch"&&ge()};_.addEventListener("*",i=>{let p=JSON.parse(i.data);x("Received event from stream: ",p),p.domain==="flag"?o(p):p.domain==="target-segment"&&s(p)})},ne=(o,s)=>T.on(o,s),we=(o,s)=>{o?T.off(o,s):se()},me=(o,s)=>{var p;let i=V[o];if(!Se&&i!==void 0){let y=i,w=o,A=O.find(k=>k.featureIdentifier===w&&k.featureValue===y);A?(oe(A),A.variationIdentifier=((p=N[w])==null?void 0:p.identifier)||""):O.push({featureIdentifier:w,featureValue:y,count:D?1:0,variationIdentifier:N[w].identifier||"",lastAccessed:Date.now()})}return i!==void 0?i:s},Te=(o,s)=>{let i;E&&E.experiment?(i=Xe(E.experiment),i.experiment(o,s,d)):console.log("experiment called but no experimentation config provided.")},se=()=>{h=!0,x("Closing event stream"),V=he(),N={},clearTimeout(j),T.all.clear(),typeof(_==null?void 0:_.close)=="function"&&_.close()};return{on:ne,off:we,variation:me,experiment:Te,close:se}};export{P as Event,mt as initialize};
/** @license
 * eventsource.js
 * Available under MIT License (MIT)
 * https://github.com/Yaffle/EventSource/
 */
